import{c as it,E as nt,r as l,p as k,b as N,t as n,j as e,X as lt,C as $,a as b,D as Ne,d as A,U as we,k as R,T as ct,a5 as dt,h as ot,m as mt,F as xt,Z as ve}from"./index-DrBwAU1T.js";import{C as x,b as F,c as C,d as W,a as h}from"./card-Cmu1fk5m.js";import{B as _}from"./badge-BVkw5bJj.js";import{T as ht,a as pt,b as ee,c as te}from"./tabs-B1Vb_bsc.js";import{A as S,a as D}from"./alert-C2ImY4gp.js";import{P as ut}from"./ProcessingStages-Bs-T1hmG.js";import{S as _e,a as Se,b as De,c as ze,d as Le}from"./select-BpfYsr0G.js";import{c as gt}from"./api-client-BUzUkZPR.js";import{D as bt,b as yt,c as jt,d as ft,e as kt,j as Nt}from"./dialog-vf0qvQXb.js";import{B as Fe}from"./building-Cu8HYSb7.js";import{F as X}from"./DevPortal--LMNXygJ.js";import{B as ae}from"./book-open-BQfJsvX3.js";import{G as wt}from"./git-compare-CNnYWnbh.js";import{L as B}from"./lock-D9w-vkY7.js";import{E as vt}from"./eye-_8xTnK9v.js";import{T as Ce}from"./trash-2-CxXCVqKn.js";import{C as _t}from"./circle-play-HhkG6Ukj.js";import{L as St}from"./lock-open-D03z0CjY.js";import"./index-BSRUjdZ4.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],zt=it("save",Dt);function Kt(){const{theme:t}=nt(),[E,Ae]=l.useState([]),[c,se]=l.useState(""),[d,re]=l.useState(""),[Y,ie]=l.useState(!0),[T,Re]=l.useState([]),[g,Te]=l.useState([]),[ne,le]=l.useState(!1),[$e,ce]=l.useState(!1),[v,Be]=l.useState(null),[w,Ee]=l.useState([]),[de,oe]=l.useState(!1),[Ue,me]=l.useState(!1),[r,U]=l.useState(null),[M,xe]=l.useState(!1),[H,Me]=l.useState(null),[J,Pe]=l.useState(!1),[P,I]=l.useState(!1),[j,Ie]=l.useState(!1),[Lt,Oe]=l.useState(null),[Ve,Ge]=l.useState("bank-statements"),[Xe,O]=l.useState(!1),V=l.useRef(null),G=l.useRef(null),he=l.useRef(!0),K=a=>a.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),pe=()=>{const a=[],s=new Date;for(let i=0;i<12;i++){const o=new Date(s.getFullYear(),s.getMonth()-i,1),u=o.getFullYear(),p=(o.getMonth()+1).toString().padStart(2,"0"),z=`${u}-${p}`,f=o.toLocaleDateString("en-US",{month:"long",year:"numeric"});a.push({value:z,label:f})}return a};l.useEffect(()=>{he.current=!0,He();const a=new Date,s=a.getFullYear(),i=(a.getMonth()+1).toString().padStart(2,"0");return re(`${s}-${i}`),()=>{he.current=!1}},[]),l.useEffect(()=>{c&&d&&(Ye(),Z(),q(),Je())},[c,d]);const Ye=async()=>{if(!(!c||!d))try{const a=await fetch(`https://${k}.supabase.co/functions/v1/make-server-53c2e113/month-close/status?companyId=${c}&period=${d}`,{headers:{Authorization:`Bearer ${N}`}});if(a.ok){const s=await a.json();Ie(s.isLocked||!1),Oe(s.isLocked?s:null),console.log("Period lock status:",s)}}catch(a){console.error("Failed to load lock status:",a)}},He=async()=>{try{ie(!0);const a=await gt.getAll();Ae(a);const s=a.find(i=>i.status==="Active");s&&se(s.id)}catch(a){console.error("Failed to load companies:",a),n.error("Failed to load companies")}finally{ie(!1)}},Z=async()=>{if(!(!c||!d))try{ce(!0);const a=await fetch(`https://${k}.supabase.co/functions/v1/make-server-53c2e113/bank-rec/bank-data?company_id=${c}&period=${d}`,{headers:{Authorization:`Bearer ${N}`}});if(a.ok){const s=await a.json();Re(s.statements||[]),Te(s.transactions||[])}}catch(a){console.error("Failed to load bank data:",a)}finally{ce(!1)}},q=async()=>{if(!(!c||!d))try{me(!0);const a=await fetch(`https://${k}.supabase.co/functions/v1/make-server-53c2e113/bank-rec/ledger-data?company_id=${c}&period=${d}`,{headers:{Authorization:`Bearer ${N}`}});if(a.ok){const s=await a.json();Be(s.ledger||null),Ee(s.entries||[])}}catch(a){console.error("Failed to load ledger data:",a)}finally{me(!1)}},Je=async()=>{if(!(!c||!d))try{const a=await fetch(`https://${k}.supabase.co/functions/v1/make-server-53c2e113/bank-rec/reconciliation-data?company_id=${c}&period=${d}`,{headers:{Authorization:`Bearer ${N}`}});if(a.ok){const s=await a.json();U(s.result||null)}}catch(a){console.error("Failed to load reconciliation data:",a)}},Ke=async a=>{const s=a.target.files?.[0];if(!s)return;if(!c||!d){n.error("Please select a company and period first");return}le(!0);const i=new FormData;i.append("bank_file",s),i.append("company_id",c),i.append("period",d);try{const o=await fetch(`https://${k}.supabase.co/functions/v1/make-server-53c2e113/bank-rec/upload-bank-statement`,{method:"POST",headers:{Authorization:`Bearer ${N}`},body:i});if(!o.ok){const p=await o.json();throw new Error(p.error||"Failed to upload bank statement")}const u=await o.json();n.success(`Uploaded ${s.name} - ${u.transactionCount} transactions extracted`),await Z(),V.current&&(V.current.value="")}catch(o){const u=o.message||"Failed to upload bank statement";n.error(u),console.error("Bank statement upload error:",o)}finally{le(!1)}},Ze=async a=>{if(confirm("Are you sure you want to delete this bank statement and all its transactions?"))try{const s=await fetch(`https://${k}.supabase.co/functions/v1/make-server-53c2e113/bank-rec/bank-statement/${a}?company_id=${c}&period=${d}`,{method:"DELETE",headers:{Authorization:`Bearer ${N}`}});if(s.ok)n.success("Bank statement deleted"),await Z();else{const i=await s.json();n.error(i.error||"Failed to delete bank statement")}}catch(s){console.error("Failed to delete bank statement:",s),n.error("Failed to delete bank statement")}},qe=async a=>{const s=a.target.files?.[0];if(!s)return;if(!c||!d){n.error("Please select a company and period first");return}oe(!0);const i=new FormData;i.append("ledger_file",s),i.append("company_id",c),i.append("period",d);try{const o=await fetch(`https://${k}.supabase.co/functions/v1/make-server-53c2e113/bank-rec/upload-ledger`,{method:"POST",headers:{Authorization:`Bearer ${N}`},body:i});if(!o.ok){const p=await o.json();throw new Error(p.error||"Failed to upload general ledger")}const u=await o.json();n.success(`Uploaded ${s.name} - ${u.entryCount} entries extracted`),await q(),G.current&&(G.current.value="")}catch(o){const u=o.message||"Failed to upload general ledger";n.error(u),console.error("Ledger upload error:",o)}finally{oe(!1)}},Qe=async()=>{if(confirm("Are you sure you want to delete the general ledger and all its entries?"))try{(await fetch(`https://${k}.supabase.co/functions/v1/make-server-53c2e113/bank-rec/ledger?company_id=${c}&period=${d}`,{method:"DELETE",headers:{Authorization:`Bearer ${N}`}})).ok?(n.success("General ledger deleted"),await q()):n.error("Failed to delete general ledger")}catch(a){console.error("Failed to delete general ledger:",a),n.error("Failed to delete general ledger")}},We=async()=>{if(g.length===0){n.error("Please upload at least one bank statement first");return}if(w.length===0){n.error("Please upload a general ledger first");return}xe(!0);try{const a=await fetch(`https://${k}.supabase.co/functions/v1/make-server-53c2e113/bank-rec/run-reconciliation`,{method:"POST",headers:{Authorization:`Bearer ${N}`,"Content-Type":"application/json"},body:JSON.stringify({company_id:c,period:d})});if(!a.ok){const i=await a.json();throw new Error(i.error||"Failed to run reconciliation")}const s=await a.json();U(s),n.success("Reconciliation completed successfully!")}catch(a){const s=a.message||"Failed to run reconciliation";n.error(s),console.error("Reconciliation error:",a)}finally{xe(!1)}},et=async()=>{if(!r){n.error("No reconciliation to save");return}I(!0);try{const a=await fetch(`https://${k}.supabase.co/functions/v1/make-server-53c2e113/bank-rec/lock-reconciliation`,{method:"POST",headers:{Authorization:`Bearer ${N}`,"Content-Type":"application/json"},body:JSON.stringify({company_id:c,period:d})});if(!a.ok){const i=await a.json();throw new Error(i.error||"Failed to save reconciliation")}const s=await a.json();U(s.reconciliation),n.success("Reconciliation saved and locked successfully!")}catch(a){const s=a.message||"Failed to save reconciliation";n.error(s),console.error("Lock reconciliation error:",a)}finally{I(!1)}},tt=async()=>{if(!r){n.error("No reconciliation to unlock");return}I(!0);try{const a=await fetch(`https://${k}.supabase.co/functions/v1/make-server-53c2e113/bank-rec/unlock-reconciliation`,{method:"POST",headers:{Authorization:`Bearer ${N}`,"Content-Type":"application/json"},body:JSON.stringify({company_id:c,period:d})});if(!a.ok){const i=await a.json();throw new Error(i.error||"Failed to unlock reconciliation")}const s=await a.json();U(s.reconciliation),n.success("Reconciliation unlocked. You can now update it.")}catch(a){const s=a.message||"Failed to unlock reconciliation";n.error(s),console.error("Unlock reconciliation error:",a)}finally{I(!1)}},ue=async a=>{try{if(g.length===0){n.error("No transactions to export");return}if(a==="csv"){const s=["Date","Description","Amount","Balance","Statement"],i=g.map(f=>[f.date,`"${f.description.replace(/"/g,'""')}"`,f.amount.toString(),f.balance?.toString()||"",f.statementName]),o=[s.join(","),...i.map(f=>f.join(","))].join(`
`),u=new Blob([o],{type:"text/csv;charset=utf-8;"}),p=URL.createObjectURL(u),z=document.createElement("a");z.href=p,z.download=`bank-transactions-${c}-${d}.csv`,z.click(),URL.revokeObjectURL(p),n.success("Transactions exported as CSV")}else{const s=await ve(()=>import("./xlsx-DGuHH-KN.js"),[]),i=[["Date","Description","Amount","Balance","Statement"],...g.map(p=>[p.date,p.description,p.amount,p.balance||"",p.statementName])],o=s.utils.aoa_to_sheet(i),u=s.utils.book_new();s.utils.book_append_sheet(u,o,"Bank Transactions"),s.writeFile(u,`bank-transactions-${c}-${d}.xlsx`),n.success("Transactions exported as Excel")}O(!1)}catch(s){n.error("Failed to export transactions"),console.error("Export error:",s)}},at=()=>{if(!r)return;const a=n.loading("Generating Excel report...");setTimeout(async()=>{try{const s=await ve(()=>import("./xlsx-DGuHH-KN.js"),[]),i=s.utils.book_new(),o=[["BANK RECONCILIATION SUMMARY"],[""],["Company",E.find(m=>m.id===c)?.name||""],["Period",pe().find(m=>m.value===d)?.label||""],["Report Date",new Date().toISOString()],[""],["Total Bank Transactions",r.summary.total_bank_transactions],["Total Ledger Entries",r.summary.total_ledger_entries],["Matched Count",r.summary.matched_count],["Unmatched Bank",r.summary.unmatched_bank_count],["Unmatched Ledger",r.summary.unmatched_ledger_count],["Match Rate",`${r.summary.match_rate.toFixed(1)}%`],[""],["Total Bank Amount",`â‚¬${r.summary.total_bank_amount.toFixed(2)}`],["Total Ledger Amount",`â‚¬${r.summary.total_ledger_amount.toFixed(2)}`],["Difference",`â‚¬${r.summary.difference.toFixed(2)}`]],u=s.utils.aoa_to_sheet(o);u["!cols"]=[{wch:25},{wch:30}],s.utils.book_append_sheet(i,u,"Summary");const p=[["Bank Date","Bank Description","Bank Amount","Ledger Date","Ledger Description","Ledger Amount","Match Type","Confidence","Explanation"]];r.matched_pairs.forEach(m=>{const L=m.bank_transaction||{},Q=Array.isArray(m.ledger_entries)?m.ledger_entries:[],je=m.match_type||"",fe=typeof m.match_confidence=="number"?`${(m.match_confidence*100).toFixed(0)}%`:"",ke=m.explanation||"";if(Q.length===1){const y=Q[0]||{};p.push([L.date||"",L.description||"",typeof L.amount=="number"?L.amount:"",y.date||"",y.description||"",typeof y.amount=="number"?y.amount:"",je,fe,ke])}else Q.forEach((y,rt)=>{rt===0?p.push([L.date||"",L.description||"",typeof L.amount=="number"?L.amount:"",y.date||"",y.description||"",typeof y.amount=="number"?y.amount:"",je,fe,ke]):p.push(["","","",y.date||"",y.description||"",typeof y.amount=="number"?y.amount:"","","",""])})});const z=s.utils.aoa_to_sheet(p);z["!cols"]=[{wch:12},{wch:35},{wch:12},{wch:12},{wch:35},{wch:12},{wch:20},{wch:12},{wch:50}],s.utils.book_append_sheet(i,z,"Matched Transactions");const f=[["Date","Description","Amount","Suggested Action","Debit Account","Credit Account"]];r.unmatched_bank.forEach(m=>{f.push([m.transaction?.date||"",m.transaction?.description||"",m.transaction?.amount||"",m.suggested_action||"",m.suggested_je?.debit_account||"",m.suggested_je?.credit_account||""])});const ge=s.utils.aoa_to_sheet(f);ge["!cols"]=[{wch:12},{wch:35},{wch:12},{wch:40},{wch:20},{wch:20}],s.utils.book_append_sheet(i,ge,"Unmatched Bank");const be=[["Date","Description","Amount","Reason","Action"]];r.unmatched_ledger.forEach(m=>{be.push([m.entry?.date||"",m.entry?.description||"",m.entry?.amount||"",m.reason||"",m.action||""])});const ye=s.utils.aoa_to_sheet(be);ye["!cols"]=[{wch:12},{wch:35},{wch:12},{wch:30},{wch:30}],s.utils.book_append_sheet(i,ye,"Unmatched Ledger");const st=`bank-reconciliation-${c}-${d}.xlsx`;s.writeFile(i,st),n.dismiss(a),n.success("Excel report exported successfully!")}catch(s){n.dismiss(a),n.error("Failed to export report"),console.error("Export error:",s)}},100)};return e.jsxs("div",{className:"space-y-10 max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:t==="premium-dark"?"text-4xl tracking-tight text-white":"text-4xl tracking-tight text-gray-900",children:"Bank Reconciliation"}),e.jsx("p",{className:t==="premium-dark"?"text-purple-300/40 text-sm mt-2":"text-gray-400 text-sm mt-2",children:"Match bank transactions with ledger entries using AI"})]})}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsxs(_e,{value:c,onValueChange:se,disabled:Y,children:[e.jsxs(Se,{className:t==="premium-dark"?"bg-white/[0.03] border-white/10 text-white hover:bg-white/[0.05] h-11 rounded-xl":"bg-gray-50/50 border-gray-200 h-11 rounded-xl",children:[e.jsx(Fe,{className:"size-4 mr-2"}),e.jsx(De,{placeholder:Y?"Loading companies...":"Select a company"})]}),e.jsxs(ze,{className:t==="premium-dark"?"bg-gray-900 border-white/10":"",children:[E.filter(a=>a.status==="Active").map(a=>e.jsxs(Le,{value:a.id,className:t==="premium-dark"?"text-gray-300 hover:bg-purple-500/10 focus:bg-purple-500/10 focus:text-white":"",children:[a.name," (",a.country,")"]},a.id)),E.filter(a=>a.status==="Active").length===0&&!Y&&e.jsx("div",{className:t==="premium-dark"?"text-sm text-gray-400 p-2 text-center":"text-sm text-gray-500 p-2 text-center",children:"No active companies. Add one first."})]})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs(_e,{value:d,onValueChange:re,children:[e.jsxs(Se,{className:t==="premium-dark"?"bg-white/[0.03] border-white/10 text-white hover:bg-white/[0.05] h-11 rounded-xl":"bg-gray-50/50 border-gray-200 h-11 rounded-xl",children:[e.jsx(lt,{className:"size-4 mr-2"}),e.jsx(De,{placeholder:"Select a period"})]}),e.jsx(ze,{className:t==="premium-dark"?"bg-gray-900 border-white/10":"",children:pe().map(a=>e.jsx(Le,{value:a.value,className:t==="premium-dark"?"text-gray-300 hover:bg-purple-500/10 focus:bg-purple-500/10 focus:text-white":"",children:a.label},a.value))})]})})]}),c&&d?e.jsxs(ht,{value:Ve,onValueChange:Ge,className:"w-full",children:[e.jsxs(pt,{className:t==="premium-dark"?"grid w-full grid-cols-3 h-auto p-1.5 gap-1 bg-white/[0.03] border border-white/10 rounded-2xl":"grid w-full grid-cols-3 h-auto p-1.5 gap-1 rounded-2xl bg-gray-100",children:[e.jsxs(ee,{value:"bank-statements",className:t==="premium-dark"?"gap-2 py-3 px-4 rounded-xl data-[state=active]:bg-white/[0.08] data-[state=active]:text-white data-[state=inactive]:text-purple-300/60 data-[state=inactive]:hover:text-white data-[state=inactive]:hover:bg-white/[0.03] transition-all":"gap-2 py-3 px-4 rounded-xl data-[state=active]:bg-white data-[state=active]:shadow-sm",children:[e.jsx(X,{className:"size-4"}),"Bank Statements",T.length>0&&e.jsx(_,{variant:"secondary",className:t==="premium-dark"?"ml-auto bg-blue-500/20 text-blue-400 border-0 px-2 py-0.5 text-xs":"ml-auto bg-blue-100 text-blue-700 px-2 py-0.5 text-xs",children:T.length})]}),e.jsxs(ee,{value:"general-ledger",className:t==="premium-dark"?"gap-2 py-3 px-4 rounded-xl data-[state=active]:bg-white/[0.08] data-[state=active]:text-white data-[state=inactive]:text-purple-300/60 data-[state=inactive]:hover:text-white data-[state=inactive]:hover:bg-white/[0.03] transition-all":"gap-2 py-3 px-4 rounded-xl data-[state=active]:bg-white data-[state=active]:shadow-sm",children:[e.jsx(ae,{className:"size-4"}),"General Ledger",v&&e.jsx(_,{variant:"secondary",className:t==="premium-dark"?"ml-auto bg-green-500/20 text-green-400 border-0 px-2 py-0.5 text-xs flex items-center gap-1":"ml-auto bg-green-100 text-green-700 px-2 py-0.5 text-xs flex items-center gap-1",children:e.jsx($,{className:"size-3"})})]}),e.jsxs(ee,{value:"reconciliation",className:t==="premium-dark"?"gap-2 py-3 px-4 rounded-xl data-[state=active]:bg-white/[0.08] data-[state=active]:text-white data-[state=inactive]:text-purple-300/60 data-[state=inactive]:hover:text-white data-[state=inactive]:hover:bg-white/[0.03] transition-all":"gap-2 py-3 px-4 rounded-xl data-[state=active]:bg-white data-[state=active]:shadow-sm",children:[e.jsx(wt,{className:"size-4"}),"Reconciliation",r&&e.jsxs(_,{variant:"secondary",className:t==="premium-dark"?"ml-auto bg-purple-500/20 text-purple-400 border-0 px-2 py-0.5 text-xs":"ml-auto bg-violet-100 text-violet-700 px-2 py-0.5 text-xs",children:[r.summary.match_rate.toFixed(0),"%"]})]})]}),e.jsxs(te,{value:"bank-statements",className:"space-y-4 mt-6",children:[j&&e.jsxs(S,{className:t==="premium-dark"?"bg-gray-800/50 border-gray-700/50 rounded-xl":"bg-gray-900 border-gray-800 rounded-xl",children:[e.jsx(B,{className:"size-4 text-white"}),e.jsxs(D,{className:"text-white",children:[e.jsx("strong",{children:"Period is locked."})," This period has been closed and locked. You cannot upload or modify bank statements while the period is locked."]})]}),r?.locked&&!j&&e.jsxs(S,{className:t==="premium-dark"?"bg-green-500/10 border-green-500/30 rounded-xl":"bg-green-50 border-green-200 rounded-xl",children:[e.jsx(B,{className:t==="premium-dark"?"size-4 text-green-400":"size-4 text-green-600"}),e.jsx(D,{className:t==="premium-dark"?"text-green-400":"text-green-700",children:'To upload more bank statements, click "Update Reconciliation" in the Reconciliation tab'})]}),e.jsxs(x,{className:t==="premium-dark"?"bg-white/[0.03] border-white/5":"bg-white border-gray-100",children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(C,{className:t==="premium-dark"?"text-white":"",children:"Upload Bank Statements"}),e.jsx(W,{className:t==="premium-dark"?"text-gray-400":"",children:"Upload PDFs, CSV, or Excel files - AI will automatically extract all transactions"})]}),e.jsxs("div",{className:"flex gap-2",children:[g.length>0&&e.jsxs(b,{variant:"outline",onClick:()=>O(!0),className:t==="premium-dark"?"gap-2 bg-white/[0.03] border-white/10 text-white hover:bg-white/[0.05]":"gap-2",children:[e.jsx(Ne,{className:"size-4"}),"Export"]}),e.jsx(b,{onClick:()=>V.current?.click(),disabled:ne||j||r?.locked,className:t==="premium-dark"?"gap-2 bg-white text-black hover:bg-white/90 rounded-full":"gap-2 rounded-full",children:ne?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"size-4 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"size-4"}),"Upload Statement"]})})]}),e.jsx("input",{ref:V,type:"file",onChange:Ke,accept:".csv,.xlsx,.xls,.pdf",className:"hidden"})]})}),T.length>0&&e.jsx(h,{className:"p-0",children:e.jsx("div",{className:t==="premium-dark"?"divide-y divide-purple-500/20":"divide-y",children:T.map(a=>e.jsxs("div",{className:t==="premium-dark"?"p-4 flex items-center justify-between hover:bg-purple-500/5":"p-4 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:t==="premium-dark"?"h-10 w-10 rounded-lg bg-blue-500/20 border border-blue-500/30 flex items-center justify-center":"h-10 w-10 rounded-lg bg-blue-50 flex items-center justify-center",children:e.jsx(X,{className:t==="premium-dark"?"size-5 text-blue-400":"size-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:t==="premium-dark"?"text-sm font-medium text-white":"text-sm font-medium text-gray-900",children:a.fileName}),e.jsxs("p",{className:t==="premium-dark"?"text-xs text-gray-400":"text-xs text-gray-500",children:[a.transactionCount," transactions â€¢ ",new Date(a.uploadedAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[a.fileUrl&&e.jsxs(b,{variant:"ghost",size:"sm",onClick:()=>window.open(a.fileUrl,"_blank"),className:t==="premium-dark"?"gap-2 text-gray-400 hover:text-white hover:bg-purple-500/10":"gap-2",children:[e.jsx(vt,{className:"size-4"}),"View"]}),e.jsxs(b,{variant:"ghost",size:"sm",onClick:()=>Ze(a.id),disabled:j||r?.locked,className:t==="premium-dark"?"gap-2 text-gray-500 hover:text-red-400 hover:bg-red-500/10":"gap-2 text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(Ce,{className:"size-4"}),"Delete"]})]})]},a.id))})})]}),$e?e.jsx(x,{className:t==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:e.jsxs(h,{className:"py-12 text-center",children:[e.jsx(A,{className:t==="premium-dark"?"size-8 text-purple-400 animate-spin mx-auto mb-3":"size-8 text-gray-400 animate-spin mx-auto mb-3"}),e.jsx("p",{className:t==="premium-dark"?"text-sm text-purple-300/40":"text-sm text-gray-400",children:"Loading transactions..."})]})}):g.length>0?e.jsxs(x,{className:t==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(C,{className:t==="premium-dark"?"text-white":"",children:"All Bank Transactions"}),e.jsxs(_,{variant:"secondary",className:t==="premium-dark"?"bg-purple-500/20 text-purple-400 border border-purple-500/30":"",children:[g.length," transactions"]})]})}),e.jsx(h,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:t==="premium-dark"?"bg-gray-800/50 border-b border-purple-500/20":"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:t==="premium-dark"?"text-left py-3 px-6 text-xs text-gray-400 font-medium":"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Date"}),e.jsx("th",{className:t==="premium-dark"?"text-left py-3 px-6 text-xs text-gray-400 font-medium":"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Description"}),e.jsx("th",{className:t==="premium-dark"?"text-left py-3 px-6 text-xs text-gray-400 font-medium":"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Amount"}),e.jsx("th",{className:t==="premium-dark"?"text-left py-3 px-6 text-xs text-gray-400 font-medium":"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Balance"}),e.jsx("th",{className:t==="premium-dark"?"text-left py-3 px-6 text-xs text-gray-400 font-medium":"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Statement"})]})}),e.jsx("tbody",{children:g.map(a=>e.jsxs("tr",{className:t==="premium-dark"?"border-b border-purple-500/20 hover:bg-purple-500/5":"border-b hover:bg-gray-50",children:[e.jsx("td",{className:t==="premium-dark"?"py-3 px-6 text-sm text-gray-400":"py-3 px-6 text-sm text-gray-600",children:a.date}),e.jsx("td",{className:t==="premium-dark"?"py-3 px-6 text-sm text-white":"py-3 px-6 text-sm text-gray-900",children:a.description}),e.jsxs("td",{className:`py-3 px-6 text-sm font-medium ${a.amount>=0?"text-green-600":"text-red-600"}`,children:["â‚¬",K(Math.abs(a.amount))]}),e.jsx("td",{className:t==="premium-dark"?"py-3 px-6 text-sm text-gray-400":"py-3 px-6 text-sm text-gray-600",children:a.balance?`â‚¬${K(a.balance)}`:"-"}),e.jsx("td",{className:t==="premium-dark"?"py-3 px-6 text-xs text-gray-400":"py-3 px-6 text-xs text-gray-500",children:a.statementName})]},a.id))})]})})})]}):e.jsx(x,{className:t==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:e.jsxs(h,{className:"py-12 text-center",children:[e.jsx(X,{className:t==="premium-dark"?"size-12 text-white/10 mx-auto mb-3":"size-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:t==="premium-dark"?"text-sm text-white/60 mb-2":"text-sm text-gray-600 mb-2",children:"No bank statements uploaded yet"}),e.jsx("p",{className:t==="premium-dark"?"text-xs text-purple-300/40":"text-xs text-gray-400",children:"Upload your first bank statement to get started"})]})})]}),e.jsxs(te,{value:"general-ledger",className:"space-y-4 mt-6",children:[j&&e.jsxs(S,{className:t==="premium-dark"?"bg-gray-800/50 border-gray-700/50 rounded-xl":"bg-gray-900 border-gray-800 rounded-xl",children:[e.jsx(B,{className:"size-4 text-white"}),e.jsxs(D,{className:"text-white",children:[e.jsx("strong",{children:"Period is locked."})," This period has been closed and locked. You cannot upload or modify the general ledger while the period is locked."]})]}),r?.locked&&!j&&e.jsxs(S,{className:t==="premium-dark"?"bg-green-500/10 border-green-500/30 rounded-xl":"bg-green-50 border-green-200 rounded-xl",children:[e.jsx(B,{className:t==="premium-dark"?"size-4 text-green-400":"size-4 text-green-600"}),e.jsx(D,{className:t==="premium-dark"?"text-green-400":"text-green-700",children:'To upload more bank statements, click "Update Reconciliation" in the Reconciliation tab'})]}),e.jsxs(x,{className:t==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(C,{className:t==="premium-dark"?"text-white":"",children:"Upload General Ledger"}),e.jsx(W,{className:t==="premium-dark"?"text-purple-300/40":"text-gray-400",children:"Upload CSV or Excel file - AI will automatically extract all ledger entries"})]}),e.jsxs("div",{className:"flex gap-2",children:[v&&e.jsxs(b,{variant:"outline",onClick:Qe,disabled:r?.locked,className:t==="premium-dark"?"gap-2 text-gray-500 hover:text-red-400 hover:bg-red-500/10 bg-white/[0.03] border-white/10":"gap-2 text-red-600 hover:text-red-700",children:[e.jsx(Ce,{className:"size-4"}),"Delete"]}),e.jsx(b,{onClick:()=>G.current?.click(),disabled:de||j||r?.locked,className:t==="premium-dark"?"gap-2 bg-white text-black hover:bg-white/90 rounded-full":"gap-2 bg-black text-white hover:bg-gray-900 rounded-full",children:de?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"size-4 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"size-4"}),v?"Replace Ledger":"Upload Ledger"]})})]}),e.jsx("input",{ref:G,type:"file",onChange:qe,accept:".csv,.xlsx,.xls",className:"hidden"})]})}),v&&e.jsx(h,{children:e.jsxs("div",{className:t==="premium-dark"?"p-4 bg-white/[0.03] rounded-lg border border-white/10 flex items-center justify-between":"p-4 bg-white rounded-lg border border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:t==="premium-dark"?"h-10 w-10 rounded-lg bg-white/[0.05] border border-white/10 flex items-center justify-center":"h-10 w-10 rounded-lg bg-gray-50 flex items-center justify-center",children:e.jsx(ae,{className:t==="premium-dark"?"size-5 text-white":"size-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:t==="premium-dark"?"text-sm font-medium text-white":"text-sm font-medium text-gray-900",children:v.fileName}),e.jsxs("p",{className:t==="premium-dark"?"text-xs text-gray-400":"text-xs text-gray-500",children:[v.entryCount," entries â€¢ ",new Date(v.uploadedAt).toLocaleDateString()]})]})]}),e.jsx($,{className:t==="premium-dark"?"size-5 text-white":"size-5 text-gray-600"})]})})]}),Ue?e.jsx(x,{className:t==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:e.jsxs(h,{className:"py-12 text-center",children:[e.jsx(A,{className:t==="premium-dark"?"size-8 text-purple-400 animate-spin mx-auto mb-3":"size-8 text-gray-400 animate-spin mx-auto mb-3"}),e.jsx("p",{className:t==="premium-dark"?"text-sm text-purple-300/40":"text-sm text-gray-400",children:"Loading entries..."})]})}):w.length>0?e.jsxs(x,{className:t==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(C,{className:t==="premium-dark"?"text-white":"",children:"All Ledger Entries"}),e.jsxs(_,{variant:"secondary",className:t==="premium-dark"?"bg-purple-500/20 text-purple-400 border border-purple-500/30":"",children:[w.length," entries"]})]})}),e.jsx(h,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:t==="premium-dark"?"bg-gray-800/50 border-b border-purple-500/20":"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:t==="premium-dark"?"text-left py-3 px-6 text-xs text-gray-400 font-medium":"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Date"}),e.jsx("th",{className:t==="premium-dark"?"text-left py-3 px-6 text-xs text-gray-400 font-medium":"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Description"}),e.jsx("th",{className:t==="premium-dark"?"text-left py-3 px-6 text-xs text-gray-400 font-medium":"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Amount"}),e.jsx("th",{className:t==="premium-dark"?"text-left py-3 px-6 text-xs text-gray-400 font-medium":"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Account"}),e.jsx("th",{className:t==="premium-dark"?"text-left py-3 px-6 text-xs text-gray-400 font-medium":"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Reference"})]})}),e.jsx("tbody",{children:w.map(a=>e.jsxs("tr",{className:t==="premium-dark"?"border-b border-purple-500/20 hover:bg-purple-500/5":"border-b hover:bg-gray-50",children:[e.jsx("td",{className:t==="premium-dark"?"py-3 px-6 text-sm text-gray-400":"py-3 px-6 text-sm text-gray-600",children:a.date}),e.jsx("td",{className:t==="premium-dark"?"py-3 px-6 text-sm text-white":"py-3 px-6 text-sm text-gray-900",children:a.description}),e.jsxs("td",{className:`py-3 px-6 text-sm font-medium ${a.amount>=0?"text-green-600":"text-red-600"}`,children:["â‚¬",K(Math.abs(a.amount))]}),e.jsx("td",{className:t==="premium-dark"?"py-3 px-6 text-sm text-gray-400":"py-3 px-6 text-sm text-gray-600",children:a.account||"-"}),e.jsx("td",{className:t==="premium-dark"?"py-3 px-6 text-xs text-gray-400":"py-3 px-6 text-xs text-gray-500",children:a.reference||"-"})]},a.id))})]})})})]}):e.jsx(x,{className:t==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:e.jsxs(h,{className:"py-12 text-center",children:[e.jsx(ae,{className:t==="premium-dark"?"size-12 text-white/10 mx-auto mb-3":"size-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:t==="premium-dark"?"text-sm text-white/60 mb-2":"text-sm text-gray-600 mb-2",children:"No general ledger uploaded yet"}),e.jsx("p",{className:t==="premium-dark"?"text-xs text-purple-300/40":"text-xs text-gray-400",children:"Upload your general ledger to continue"})]})})]}),e.jsxs(te,{value:"reconciliation",className:"space-y-4 mt-6",children:[j&&e.jsxs(S,{className:t==="premium-dark"?"bg-gray-800/50 border-gray-700/50 rounded-xl":"bg-gray-900 border-gray-800 rounded-xl",children:[e.jsx(B,{className:"size-4 text-white"}),e.jsxs(D,{className:"text-white",children:[e.jsx("strong",{children:"Period is locked."})," This period has been closed and locked. You cannot run or update the reconciliation while the period is locked."]})]}),e.jsxs(x,{className:t==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:[e.jsxs(F,{children:[e.jsx(C,{className:t==="premium-dark"?"text-white":"",children:"Run Reconciliation"}),e.jsx(W,{className:t==="premium-dark"?"text-purple-300/40":"text-gray-500",children:"Automatically match bank transactions with general ledger entries"})]}),e.jsxs(h,{className:"space-y-4",children:[g.length===0&&e.jsxs(S,{className:t==="premium-dark"?"bg-white/[0.03] border-white/10 rounded-xl":"rounded-xl",children:[e.jsx(R,{className:t==="premium-dark"?"size-4 text-white/40":"size-4"}),e.jsx(D,{className:t==="premium-dark"?"text-white/60":"",children:'Please upload at least one bank statement in the "Bank Statements" tab before running reconciliation.'})]}),w.length===0&&e.jsxs(S,{className:t==="premium-dark"?"bg-white/[0.03] border-white/10 rounded-xl":"rounded-xl",children:[e.jsx(R,{className:t==="premium-dark"?"size-4 text-white/40":"size-4"}),e.jsx(D,{className:t==="premium-dark"?"text-white/60":"",children:'Please upload a general ledger in the "General Ledger" tab before running reconciliation.'})]}),g.length>0&&w.length===0&&e.jsxs(S,{variant:"destructive",className:"rounded-xl",children:[e.jsx(R,{className:"size-4"}),e.jsxs(D,{children:[e.jsx("strong",{children:"Error:"}),' General ledger is missing. Please upload it in the "General Ledger" tab.']})]}),g.length>0&&w.length>0&&!r&&e.jsxs(S,{className:t==="premium-dark"?"bg-blue-500/10 border-blue-500/30 rounded-xl":"bg-blue-50 border-blue-200 rounded-xl",children:[e.jsx($,{className:t==="premium-dark"?"size-4 text-blue-400":"size-4 text-blue-600"}),e.jsxs(D,{className:t==="premium-dark"?"text-blue-400":"text-blue-900",children:[e.jsx("strong",{children:"Ready to reconcile:"})," ",g.length," bank transactions and ",w.length," ledger entries.",e.jsx("br",{}),e.jsx("span",{className:t==="premium-dark"?"text-sm text-blue-400/70":"text-sm text-blue-700",children:"Make sure you've uploaded all bank statements before proceeding."})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:t==="premium-dark"?"p-5 bg-white/[0.02] border border-white/5 rounded-2xl":"p-5 bg-gray-50/50 border border-gray-100 rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:t==="premium-dark"?"text-sm text-purple-300/40":"text-sm text-gray-400",children:"Bank Statements"}),T.length>0?e.jsx($,{className:t==="premium-dark"?"size-4 text-green-400":"size-4 text-green-600"}):e.jsx(R,{className:t==="premium-dark"?"size-4 text-white/20":"size-4 text-gray-400"})]}),e.jsx("p",{className:t==="premium-dark"?"text-3xl text-white tracking-tight":"text-3xl text-gray-900 tracking-tight",children:T.length}),e.jsxs("p",{className:t==="premium-dark"?"text-xs text-purple-300/30 mt-1":"text-xs text-gray-400 mt-1",children:[g.length," transactions"]})]}),e.jsxs("div",{className:t==="premium-dark"?"p-5 bg-white/[0.02] border border-white/5 rounded-2xl":"p-5 bg-gray-50/50 border border-gray-100 rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:t==="premium-dark"?"text-sm text-purple-300/40":"text-sm text-gray-400",children:"General Ledger"}),v?e.jsx($,{className:t==="premium-dark"?"size-4 text-green-400":"size-4 text-green-600"}):e.jsx(R,{className:t==="premium-dark"?"size-4 text-white/20":"size-4 text-gray-400"})]}),e.jsx("p",{className:t==="premium-dark"?"text-3xl text-white tracking-tight":"text-3xl text-gray-900 tracking-tight",children:v?"1":"0"}),e.jsxs("p",{className:t==="premium-dark"?"text-xs text-purple-300/30 mt-1":"text-xs text-gray-400 mt-1",children:[w.length," entries"]})]})]}),e.jsx(b,{onClick:We,disabled:M||g.length===0||w.length===0||j||r?.locked,className:t==="premium-dark"?"w-full gap-2 h-12 bg-white text-black hover:bg-white/90 rounded-full":"w-full gap-2 h-12 bg-black text-white hover:bg-gray-900 rounded-full",size:"lg",children:M?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"size-5 animate-spin"}),"Running Reconciliation..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_t,{className:"size-5"}),r?.locked?"Reconciliation Locked":j?"Period Locked":"Run Bank Reconciliation"]})})]})]}),M&&e.jsx(x,{children:e.jsx(h,{className:"py-12",children:e.jsx(ut,{type:"bank-rec"})})}),r&&!M&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(x,{className:t==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Matched"}),e.jsx("p",{className:"text-3xl text-gray-900 mt-1",children:r.summary?.matched_count??0})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-violet-50 flex items-center justify-center",children:e.jsx($,{className:"size-6 text-violet-600"})})]})})}),e.jsx(x,{className:t==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:t==="premium-dark"?"text-sm text-purple-300/40":"text-sm text-gray-400",children:"Unmatched Bank"}),e.jsx("p",{className:t==="premium-dark"?"text-3xl text-white mt-1 tracking-tight":"text-3xl text-gray-900 mt-1 tracking-tight",children:r.summary?.unmatched_bank_count??0})]}),e.jsx("div",{className:t==="premium-dark"?"h-12 w-12 rounded-full bg-white/5 flex items-center justify-center":"h-12 w-12 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(R,{className:t==="premium-dark"?"size-6 text-white/30":"size-6 text-gray-500"})})]})})}),e.jsx(x,{className:t==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:t==="premium-dark"?"text-sm text-purple-300/40":"text-sm text-gray-400",children:"Unmatched Ledger"}),e.jsx("p",{className:t==="premium-dark"?"text-3xl text-white mt-1 tracking-tight":"text-3xl text-gray-900 mt-1 tracking-tight",children:r.summary?.unmatched_ledger_count??0})]}),e.jsx("div",{className:t==="premium-dark"?"h-12 w-12 rounded-full bg-white/5 flex items-center justify-center":"h-12 w-12 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(R,{className:t==="premium-dark"?"size-6 text-white/30":"size-6 text-gray-500"})})]})})}),e.jsx(x,{className:t==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:t==="premium-dark"?"text-sm text-purple-300/40":"text-sm text-gray-400",children:"Match Rate"}),e.jsxs("p",{className:"text-3xl text-violet-500 mt-1 tracking-tight",children:[r.summary?.match_rate.toFixed(1)??0,"%"]})]}),e.jsx("div",{className:t==="premium-dark"?"h-12 w-12 rounded-full bg-violet-500/10 flex items-center justify-center":"h-12 w-12 rounded-full bg-violet-50 flex items-center justify-center",children:e.jsx(ct,{className:"size-6 text-violet-500"})})]})})})]}),!j&&r.locked?e.jsx(x,{className:t==="premium-dark"?"bg-green-500/10 border-green-500/30 rounded-2xl":"bg-green-50 border-green-200 rounded-2xl",children:e.jsx(h,{className:"pt-6 pb-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:t==="premium-dark"?"h-12 w-12 rounded-xl bg-green-500/20 border border-green-500/30 flex items-center justify-center flex-shrink-0":"h-12 w-12 rounded-xl bg-green-100 flex items-center justify-center flex-shrink-0",children:e.jsx(B,{className:t==="premium-dark"?"size-5 text-green-400":"size-5 text-green-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:t==="premium-dark"?"text-green-400":"text-green-900",children:"Reconciliation Locked"}),e.jsxs("p",{className:t==="premium-dark"?"text-sm text-green-400/70 mt-1":"text-sm text-green-700 mt-1",children:["This reconciliation has been saved and locked for ",E.find(a=>a.id===c)?.name," - ",d,".",r.lockedAt&&e.jsxs("span",{className:"block mt-1",children:["Locked on: ",new Date(r.lockedAt).toLocaleString()]})]})]})]}),e.jsx(b,{onClick:tt,disabled:P||j,variant:"outline",className:t==="premium-dark"?"gap-2 bg-green-500/10 border-green-500/30 text-green-400 hover:bg-green-500/20 rounded-full flex-shrink-0":"gap-2 border-green-300 hover:bg-green-100 rounded-full flex-shrink-0",children:P?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"size-4 animate-spin"}),"Unlocking..."]}):e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"size-4"}),"Update Reconciliation"]})})]})})}):e.jsx(x,{className:t==="premium-dark"?"bg-amber-500/10 border-amber-500/30 rounded-2xl":"bg-amber-50 border-amber-200 rounded-2xl",children:e.jsx(h,{className:"pt-6 pb-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:t==="premium-dark"?"h-12 w-12 rounded-xl bg-amber-500/20 border border-amber-500/30 flex items-center justify-center flex-shrink-0":"h-12 w-12 rounded-xl bg-amber-100 flex items-center justify-center flex-shrink-0",children:e.jsx(dt,{className:t==="premium-dark"?"size-5 text-amber-400":"size-5 text-amber-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:t==="premium-dark"?"text-amber-400":"text-amber-900",children:"Please Review Before Saving"}),e.jsx("p",{className:t==="premium-dark"?"text-sm text-amber-400/70 mt-1":"text-sm text-amber-700 mt-1",children:"Carefully review the reconciliation results above to ensure accuracy. Once locked, this reconciliation will be saved for this company and period."})]})]}),e.jsx(b,{onClick:et,disabled:P,className:t==="premium-dark"?"gap-2 bg-white text-black hover:bg-white/90 rounded-full flex-shrink-0":"gap-2 bg-black text-white hover:bg-gray-900 rounded-full flex-shrink-0",children:P?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"size-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(zt,{className:"size-4"}),"Save Reconciliation"]})})]})})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(b,{onClick:at,variant:"outline",className:t==="premium-dark"?"gap-2 bg-white/[0.03] border-white/10 text-white hover:bg-white/[0.05] rounded-full":"gap-2 rounded-full",children:[e.jsx(Ne,{className:"size-4"}),"Export Report"]})}),(r.matched_pairs?.length??0)>0&&e.jsxs(x,{children:[e.jsx(F,{className:"border-b bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(C,{className:"text-base",children:"Matched Transactions"}),e.jsx(_,{variant:"secondary",className:"bg-violet-50 text-violet-700 border-violet-200",children:r.matched_pairs.length})]})}),e.jsxs(h,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Description"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Amount"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Type"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Confidence"}),e.jsx("th",{className:"text-center py-3 px-6 text-xs text-gray-500 font-medium"})]})}),e.jsx("tbody",{children:(J?r.matched_pairs:r.matched_pairs.slice(0,10)).map((a,s)=>e.jsxs(l.Fragment,{children:[e.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>Me(H===s?null:s),children:[e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:a.bank_transaction.date}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-900",children:a.bank_transaction.description}),e.jsxs("td",{className:"py-4 px-6 text-sm text-gray-900 font-medium",children:["â‚¬",Math.abs(a.bank_transaction.amount).toFixed(2)]}),e.jsx("td",{className:"py-4 px-6",children:e.jsx(_,{variant:"outline",className:a.match_type==="exact"?"bg-violet-50 text-violet-700 border-violet-200":a.match_type==="tolerance"?"bg-green-50 text-green-700 border-green-200":a.match_type==="fee_adjusted"?"bg-orange-50 text-orange-700 border-orange-200":a.match_type==="fx_adjusted"||a.match_type==="fx"?"bg-blue-50 text-blue-700 border-blue-200":"bg-gray-50 text-gray-600 border-gray-200",children:a.match_type==="fx_adjusted"||a.match_type==="fx"?"FX":a.match_type==="tolerance"?"Tolerance":a.match_type==="fee_adjusted"?"Fee":a.match_type})}),e.jsxs("td",{className:"py-4 px-6 text-sm text-gray-600",children:[(a.match_confidence*100).toFixed(0),"%"]}),e.jsx("td",{className:"py-4 px-6 text-center",children:e.jsx("span",{className:"text-gray-400 text-xs",children:H===s?"â–²":"â–¼"})})]}),e.jsx(ot,{children:H===s&&e.jsx(mt.tr,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsx("td",{colSpan:6,className:"bg-gray-50 px-6 py-4 border-b",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium mb-2",children:"Matched Ledger Entries:"}),a.ledger_entries.map((i,o)=>e.jsx("div",{className:"bg-white border border-gray-200 rounded px-3 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-gray-900",children:i.description}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[i.date,i.account&&` â€¢ Account: ${i.account}`]})]}),e.jsxs("p",{className:"text-gray-900 font-medium ml-4",children:["â‚¬",Math.abs(i.amount).toFixed(2)]})]})},o)),a.match_type==="fx_adjusted"&&a.fx_rate&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded text-xs",children:[e.jsx("p",{className:"font-medium text-blue-900 mb-1",children:"ðŸŒ FX Transaction Details:"}),e.jsxs("div",{className:"space-y-1 text-blue-700",children:[e.jsxs("p",{children:["Exchange Rate: ",e.jsx("span",{className:"font-mono",children:a.fx_rate.toFixed(4)})]}),e.jsxs("p",{children:["FX Fee: ",e.jsxs("span",{className:"font-mono",children:["â‚¬",a.fx_fee?.toFixed(2)||"0.00"]})]}),e.jsx("p",{className:"text-blue-600 mt-2",children:a.explanation})]})]})]})})})})]},s))})]})}),r.matched_pairs.length>10&&e.jsx("div",{className:"border-t bg-gray-50 py-3 text-center",children:e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>Pe(!J),className:"text-violet-600 hover:text-violet-700 hover:bg-violet-50",children:J?"Show Less":`Show ${r.matched_pairs.length-10} More Transaction${r.matched_pairs.length-10!==1?"s":""}`})})]})]}),(r.unmatched_bank?.length??0)>0&&e.jsxs(x,{children:[e.jsx(F,{className:"border-b bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(C,{className:"text-base",children:"Unmatched Bank Transactions"}),e.jsx(_,{variant:"secondary",className:"bg-gray-100 text-gray-700 border-gray-200",children:r.unmatched_bank.length})]})}),e.jsx(h,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Description"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Amount"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Suggested Action"})]})}),e.jsx("tbody",{children:r.unmatched_bank.map((a,s)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:a.transaction.date}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-900",children:a.transaction.description}),e.jsxs("td",{className:"py-4 px-6 text-sm text-gray-900 font-medium",children:["â‚¬",Math.abs(a.transaction.amount).toFixed(2)]}),e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-gray-600",children:a.suggested_action}),a.suggested_je&&e.jsxs("div",{className:"text-xs text-gray-500 bg-gray-50 rounded px-2 py-1 mt-1 inline-block",children:["DR: ",a.suggested_je.debit_account," â€¢ CR: ",a.suggested_je.credit_account]})]})})]},s))})]})})})]}),(r.unmatched_ledger?.length??0)>0&&e.jsxs(x,{children:[e.jsx(F,{className:"border-b bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(C,{className:"text-base",children:"Unmatched Ledger Entries"}),e.jsx(_,{variant:"secondary",className:"bg-gray-100 text-gray-700 border-gray-200",children:r.unmatched_ledger.length})]})}),e.jsx(h,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Description"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Amount"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Reason"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Action"})]})}),e.jsx("tbody",{children:r.unmatched_ledger.map((a,s)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:a.entry.date}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-900",children:a.entry.description}),e.jsxs("td",{className:"py-4 px-6 text-sm text-gray-900 font-medium",children:["â‚¬",Math.abs(a.entry.amount).toFixed(2)]}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:a.reason}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:a.action})]},s))})]})})})]})]})]})]}):e.jsx(x,{children:e.jsxs(h,{className:"py-12 text-center",children:[e.jsx(Fe,{className:"size-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Please select a company and period to get started"})]})}),e.jsx(bt,{open:Xe,onOpenChange:O,children:e.jsxs(yt,{children:[e.jsxs(jt,{children:[e.jsx(ft,{children:"Export Bank Transactions"}),e.jsxs(kt,{children:["Choose the format for exporting ",g.length," transaction",g.length!==1?"s":""]})]}),e.jsxs("div",{className:"space-y-3 py-4",children:[e.jsxs(b,{onClick:()=>ue("csv"),variant:"outline",className:"w-full justify-start gap-3 h-auto py-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-green-50 flex items-center justify-center",children:e.jsx(xt,{className:"size-5 text-green-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-sm",children:"CSV Format"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Compatible with Excel, Google Sheets, and most software"})]})]}),e.jsxs(b,{onClick:()=>ue("xlsx"),variant:"outline",className:"w-full justify-start gap-3 h-auto py-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-blue-50 flex items-center justify-center",children:e.jsx(X,{className:"size-5 text-blue-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-sm",children:"Excel Format (.xlsx)"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Native Excel format with formatting preserved"})]})]})]}),e.jsx(Nt,{children:e.jsx(b,{variant:"ghost",onClick:()=>O(!1),children:"Cancel"})})]})})]})}export{Kt as BankReconciliation};
