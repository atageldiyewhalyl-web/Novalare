import{E as R,r as n,j as e,a as v,$ as P}from"./index-DrBwAU1T.js";import{B as _}from"./badge-BVkw5bJj.js";import{c as j,i as N,r as w}from"./api-client-BUzUkZPR.js";import{A as k}from"./AddCompanyDialog-DEyf6AM7.js";import{B as C}from"./building-Cu8HYSb7.js";import"./dialog-vf0qvQXb.js";import"./DevPortal--LMNXygJ.js";import"./label-BCNN39XH.js";import"./select-BpfYsr0G.js";import"./index-BSRUjdZ4.js";import"./plus-B8Ewa_Kr.js";function Y({onNavigate:z}){const{theme:t}=R(),[u,x]=n.useState([]),[A,p]=n.useState(!0),[g,b]=n.useState(null),[h,f]=n.useState(!1);n.useEffect(()=>{d();const r=setInterval(()=>{y()},3e4);return()=>clearInterval(r)},[]);const d=async()=>{try{p(!0),b(null);const r=await j.getAll(),o=await Promise.all(r.map(async s=>{try{const[i,l]=await Promise.all([N.getByCompany(s.id),w.getByCompany(s.id)]),m=i.filter(a=>a.status==="Pending").length,c=l.filter(a=>a.status==="Pending").length;return{...s,pendingCount:m+c}}catch(i){return console.error(`Failed to load pending count for company ${s.id}:`,i),{...s,pendingCount:0}}}));x(o)}catch(r){console.error("Failed to load dashboard data:",r),b(r instanceof Error?r.message:"Failed to load data")}finally{p(!1)}},y=async()=>{try{const r=await j.getAll(),o=await Promise.all(r.map(async s=>{try{const[i,l]=await Promise.all([N.getByCompany(s.id),w.getByCompany(s.id)]),m=i.filter(a=>a.status==="Pending").length,c=l.filter(a=>a.status==="Pending").length;return{...s,pendingCount:m+c}}catch{return{...s,pendingCount:0}}}));x(o),console.log("âœ… Dashboard auto-refreshed")}catch(r){console.error("Failed to auto-refresh dashboard:",r)}},B=async()=>{f(!0),await y(),setTimeout(()=>f(!1),500)};return A?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:t==="premium-dark"?"w-12 h-12 border-4 border-purple-500/30 border-t-purple-500 rounded-full animate-spin mx-auto mb-4":"w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:t==="premium-dark"?"text-purple-200":"text-gray-600",children:"Loading dashboard..."})]})}):g?e.jsxs("div",{className:t==="premium-dark"?"p-6 bg-red-900/20 border border-red-500/30 rounded-lg":"p-6 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("p",{className:t==="premium-dark"?"text-red-400":"text-red-600",children:["Error: ",g]}),e.jsx(v,{onClick:d,variant:"outline",className:"mt-4",children:"Retry"})]}):e.jsxs("div",{className:"max-w-7xl mx-auto space-y-12",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:t==="premium-dark"?"text-4xl text-white tracking-tight":"text-4xl text-gray-900 tracking-tight",children:"Your Companies"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{onClick:B,variant:"outline",size:"icon",disabled:h,className:t==="premium-dark"?"bg-white/5 border-white/10 hover:bg-white/10 hover:border-white/20 transition-all":"border-gray-200 hover:bg-gray-50",title:"Refresh dashboard",children:e.jsx(P,{className:`size-4 ${h?"animate-spin":""} ${t==="premium-dark"?"text-purple-300":"text-gray-600"}`})}),e.jsx(k,{onSuccess:d})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5",children:u.map(r=>e.jsxs("button",{onClick:()=>z("company",{companyId:r.id}),className:t==="premium-dark"?"group relative text-left bg-gradient-to-br from-white/[0.07] to-white/[0.03] border border-white/10 backdrop-blur-xl rounded-2xl p-6 hover:border-purple-500/40 transition-all duration-300 hover:shadow-[0_20px_60px_-15px_rgba(139,92,246,0.4)] hover:scale-[1.02]":"group relative text-left bg-white border border-gray-200 rounded-2xl p-6 hover:border-gray-300 hover:shadow-[0_20px_60px_-15px_rgba(0,0,0,0.1)] transition-all duration-300 hover:scale-[1.02]",children:[r.pendingCount>0&&e.jsx("div",{className:"absolute -top-2 -right-2 z-10",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 size-6 bg-yellow-400 rounded-full animate-ping opacity-75"}),e.jsx("div",{className:"relative size-6 bg-yellow-400 rounded-full border-2 border-white flex items-center justify-center shadow-lg",children:e.jsx("span",{className:"text-[10px] font-bold text-yellow-900",children:r.pendingCount})})]})}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:t==="premium-dark"?"size-14 rounded-xl bg-gradient-to-br from-purple-500/20 to-pink-500/20 flex items-center justify-center ring-1 ring-purple-500/30 group-hover:ring-purple-500/50 transition-all duration-300 flex-shrink-0":"size-14 rounded-xl bg-gradient-to-br from-blue-50 to-blue-100 flex items-center justify-center ring-1 ring-blue-200 group-hover:ring-blue-300 transition-all duration-300 flex-shrink-0",children:e.jsx(C,{className:t==="premium-dark"?"size-7 text-purple-400":"size-7 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:t==="premium-dark"?"text-base font-semibold text-white mb-1 truncate":"text-base font-semibold text-gray-900 mb-1 truncate",children:r.name}),e.jsx("p",{className:t==="premium-dark"?"text-xs text-purple-300/60 mb-2":"text-xs text-gray-500 mb-2",children:r.country}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(_,{variant:"secondary",className:t==="premium-dark"?r.status==="Active"?"bg-emerald-500/10 text-emerald-400 text-[10px] font-medium border border-emerald-500/20 px-2 py-0.5 rounded-full":"bg-gray-500/10 text-gray-400 text-[10px] font-medium border border-gray-500/20 px-2 py-0.5 rounded-full":r.status==="Active"?"bg-emerald-50 text-emerald-700 text-[10px] font-medium border border-emerald-100 px-2 py-0.5 rounded-full":"bg-gray-100 text-gray-600 text-[10px] font-medium border border-gray-200 px-2 py-0.5 rounded-full",children:r.status})})]})]})]},r.id))}),u.length===0&&e.jsxs("div",{className:t==="premium-dark"?"text-center py-16 px-4 border-2 border-dashed border-white/10 rounded-2xl":"text-center py-16 px-4 border-2 border-dashed border-gray-200 rounded-2xl",children:[e.jsx(C,{className:t==="premium-dark"?"size-16 text-purple-500/30 mx-auto mb-4":"size-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:t==="premium-dark"?"text-lg font-semibold text-white mb-2":"text-lg font-semibold text-gray-900 mb-2",children:"No companies yet"}),e.jsx("p",{className:t==="premium-dark"?"text-sm text-purple-300/60 mb-6":"text-sm text-gray-500 mb-6",children:"Get started by adding your first client company"}),e.jsx(k,{onSuccess:d})]})]})]})}export{Y as Dashboard};
