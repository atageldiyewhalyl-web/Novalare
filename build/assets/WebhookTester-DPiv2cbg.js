import{c as T,r as o,j as e,a1 as i,p as D,a as k,a2 as C,U as L,t as a,b as M}from"./index-DrBwAU1T.js";import{C as m,b as h,c as x,d as p,a as u}from"./card-Cmu1fk5m.js";import{L as n}from"./label-BCNN39XH.js";import{T as P}from"./textarea-Dy3VbiTo.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]],A=T("webhook",z);function H(){const[j,w]=o.useState("vendor@example.com"),[g,S]=o.useState("invoices@mg.novalare.com"),[b,F]=o.useState("Invoice #12345"),[f,R]=o.useState("Please find the attached invoice for payment."),[r,y]=o.useState([]),[v,N]=o.useState(!1),c=`https://${D}.supabase.co/functions/v1/make-server-53c2e113/api/webhook/mailgun`,E=s=>{s.target.files&&y(Array.from(s.target.files))},U=async()=>{if(r.length===0){a.error("Please select at least one PDF file");return}N(!0);try{const s=new FormData;s.append("from",j),s.append("To",g),s.append("subject",b),s.append("body-plain",f),s.append("timestamp",Math.floor(Date.now()/1e3).toString()),r.forEach((d,I)=>{s.append(`attachment-${I+1}`,d)}),console.log("üöÄ Sending webhook test to:",c);const t=await fetch(c,{method:"POST",headers:{Authorization:`Bearer ${M}`},body:s}),l=await t.json();if(t.ok&&l.success){a.success(`‚úÖ Webhook processed! ${l.message}`),console.log("Webhook response:",l),y([]);const d=document.getElementById("file-input");d&&(d.value="")}else a.error(`Failed: ${l.error||l.message||"Unknown error"}`),console.error("Webhook error:",l)}catch(s){console.error("Webhook test error:",s),a.error("Failed to send webhook test")}finally{N(!1)}},W=()=>{try{const s=document.createElement("textarea");s.value=c,s.style.position="fixed",s.style.left="-999999px",s.style.top="-999999px",document.body.appendChild(s),s.focus(),s.select();const t=document.execCommand("copy");document.body.removeChild(s),t?a.success("Webhook URL copied to clipboard!"):a.error("Failed to copy. Please manually select and copy the URL.")}catch(s){console.error("Copy failed:",s),a.error("Failed to copy. Please manually select and copy the URL.")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl text-gray-900",children:"Email Webhook Setup"}),e.jsxs("p",{className:"text-gray-500 mt-1",children:["Configure Mailgun to automatically process invoices sent to ",e.jsx("strong",{children:"invoices@mg.novalare.com"})]})]}),e.jsxs(m,{className:"border-purple-200 bg-purple-50",children:[e.jsxs(h,{children:[e.jsx(x,{className:"text-purple-900",children:"üöÄ Quick Setup (3 Steps)"}),e.jsx(p,{className:"text-purple-700",children:"Get invoice processing via email working in 2 minutes"})]}),e.jsxs(u,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-purple-900",children:"1."}),e.jsx("div",{children:e.jsx("p",{className:"text-purple-900",children:e.jsx("strong",{children:"Copy the webhook URL below"})})})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-purple-900",children:"2."}),e.jsx("div",{children:e.jsxs("p",{className:"text-purple-900",children:[e.jsx("strong",{children:"Log in to Mailgun:"})," ",e.jsx("a",{href:"https://app.mailgun.com",target:"_blank",rel:"noopener",className:"underline",children:"app.mailgun.com"})]})})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-purple-900",children:"3."}),e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-900",children:e.jsx("strong",{children:"Create a Route:"})}),e.jsxs("ul",{className:"ml-4 mt-1 space-y-1 text-purple-800",children:[e.jsxs("li",{children:["‚Ä¢ Go to ",e.jsx("strong",{children:"Sending ‚Üí Routes"})]}),e.jsxs("li",{children:["‚Ä¢ Click ",e.jsx("strong",{children:"Create Route"})]}),e.jsxs("li",{children:["‚Ä¢ Match Recipient: ",e.jsx("code",{className:"bg-white px-1 rounded",children:"*@mg.novalare.com"})]}),e.jsxs("li",{children:["‚Ä¢ Actions: Check ",e.jsx("strong",{children:'"Forward"'})]}),e.jsx("li",{children:"‚Ä¢ URL: Paste the webhook URL from step 1"}),e.jsxs("li",{children:["‚Ä¢ Click ",e.jsx("strong",{children:"Create Route"})]})]})]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-white rounded border border-purple-200",children:e.jsxs("p",{className:"text-sm text-purple-900",children:["‚úÖ ",e.jsx("strong",{children:"Done!"})," Emails sent to ",e.jsx("code",{className:"bg-purple-100 px-1 rounded",children:"invoices@mg.novalare.com"})," will automatically be processed."]})})]})]}),e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"size-5"}),"Webhook Endpoint"]}),e.jsx(p,{children:"Use this URL in Mailgun's webhook configuration"})]}),e.jsx(u,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{value:c,readOnly:!0,className:"font-mono text-sm"}),e.jsx(k,{onClick:W,variant:"outline",children:"Copy"})]})})]}),e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"size-5"}),"Simulate Mailgun Webhook"]}),e.jsx(p,{children:"Upload invoice PDFs to test the automatic processing pipeline"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"from",children:"From Email"}),e.jsx(i,{id:"from",value:j,onChange:s=>w(s.target.value),placeholder:"vendor@example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"to",children:"To Email (Recipient)"}),e.jsx(i,{id:"to",value:g,onChange:s=>S(s.target.value),placeholder:"invoices@mg.novalare.com"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Use format: company-2@mg.novalare.com to route to specific company"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"subject",children:"Subject"}),e.jsx(i,{id:"subject",value:b,onChange:s=>F(s.target.value),placeholder:"Invoice #12345"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"body",children:"Email Body"}),e.jsx(P,{id:"body",value:f,onChange:s=>R(s.target.value),placeholder:"Email message body...",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"file-input",children:"Attachments (PDF only)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{id:"file-input",type:"file",accept:".pdf,application/pdf",multiple:!0,onChange:E,className:"cursor-pointer"}),e.jsx(L,{className:"size-5 text-gray-400"})]}),r.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:r.map((s,t)=>e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-2",children:[e.jsx("div",{className:"size-2 bg-green-500 rounded-full"}),s.name," (",(s.size/1024).toFixed(1)," KB)"]},t))})]}),e.jsx("div",{className:"flex gap-3 pt-4",children:e.jsx(k,{onClick:U,disabled:v||r.length===0,className:"gap-2",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"size-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"size-4"}),"Send Test Webhook"]})})}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"üí° How it works:"}),e.jsxs("ol",{className:"text-sm text-blue-800 space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"Select one or more PDF invoices"}),e.jsx("li",{children:"Fill in the email details (or use defaults)"}),e.jsx("li",{children:'Click "Send Test Webhook"'}),e.jsx("li",{children:"The system will extract invoice data using OpenAI"}),e.jsx("li",{children:"Check the Invoice Extraction page to see the results"})]})]}),e.jsxs("div",{className:"mt-4 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-amber-900 mb-2",children:"‚ö†Ô∏è Company Routing:"}),e.jsxs("ul",{className:"text-sm text-amber-800 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("code",{className:"bg-amber-100 px-1 py-0.5 rounded",children:"company-1@domain.com"})," ‚Üí Routes to Company ID: 1"]}),e.jsxs("li",{children:[e.jsx("code",{className:"bg-amber-100 px-1 py-0.5 rounded",children:"invoices+acme@domain.com"})," ‚Üí Routes to Company ID: acme"]}),e.jsx("li",{children:"Default: Company ID 1 if no pattern matches"})]})]})]})]}),e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"üìö Setup Instructions"}),e.jsx(p,{children:"How to configure Mailgun for automatic email processing"})]}),e.jsxs(u,{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"1. Sign up for Mailgun"}),e.jsxs("p",{className:"text-gray-600",children:["Create a free account at ",e.jsx("a",{href:"https://mailgun.com",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"mailgun.com"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"2. Configure Webhook"}),e.jsx("p",{className:"text-gray-600",children:"In Mailgun dashboard, go to Webhooks and add the endpoint URL shown above"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"3. Set up Email Route"}),e.jsx("p",{className:"text-gray-600",children:"Create a route to forward emails to your webhook endpoint"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"4. Test with Real Emails"}),e.jsx("p",{className:"text-gray-600",children:"Forward invoice emails to your Mailgun address (e.g., invoices@sandbox.mailgun.org)"})]}),e.jsx("div",{className:"pt-2",children:e.jsx("a",{href:"/EMAIL_WEBHOOK_SETUP.md",target:"_blank",className:"text-blue-600 hover:underline font-medium",children:"üìÑ View Full Setup Guide ‚Üí"})})]})]})]})}export{H as WebhookTester};
