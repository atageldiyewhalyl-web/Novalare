import{c as Ne,r as l,j as e,M as U,a as o,a2 as K,a1 as X,U as W,a3 as $,l as fe,F as z,V as Q,W as be,X as Y,a0 as we,T as Ce,R as De,D as Ae,t as h}from"./index-DrBwAU1T.js";import{C as u,a as g,b as j,c as y}from"./card-Cmu1fk5m.js";import{B as D}from"./badge-BVkw5bJj.js";import{T as Ee,a as ke,b as N,c as f}from"./tabs-B1Vb_bsc.js";import{c as G,d as Z,a as Se,m as ze,e as ee,i as se,r as te}from"./api-client-BUzUkZPR.js";import{D as ae,a as Fe,b as re,c as ie,d as le,e as ce}from"./dialog-vf0qvQXb.js";import{T as Re}from"./textarea-Dy3VbiTo.js";import{L as P}from"./label-BCNN39XH.js";import{ChartOfAccountsManager as Te}from"./ChartOfAccountsManager-vt9jujwN.js";import{E as Ie,A as Pe,a as Ue,b as $e,c as Be,d as Le,e as Me,f as Oe,g as Ve}from"./alert-dialog-CCoop3_z.js";import{C as Ge}from"./DevPortal--LMNXygJ.js";import{B as Je}from"./building-Cu8HYSb7.js";import{T as ne}from"./trash-2-CxXCVqKn.js";import{C as oe}from"./circle-Hwsfi-tY.js";import"./book-open-BQfJsvX3.js";import"./plus-B8Ewa_Kr.js";import"./pen-BV3r-nQd.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"M13.234 20.252 21 12.3",key:"1cbrk9"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486",key:"1pkts6"}]],J=Ne("paperclip",We);function _e({emails:c,companyId:A,companyEmail:b,onSendEmail:B}){const[r,n]=l.useState(null),[L,E]=l.useState(!1),[k,M]=l.useState(!1),[p,x]=l.useState({from:"",subject:"",body:""}),[v,F]=l.useState([]),S=b||`invoices+${A}@novalare.com`,R=async()=>{if(!p.from||!p.subject||v.length===0){alert("Please fill in all required fields and attach at least one invoice");return}M(!0);try{console.log("ðŸ“§ Sending test email with attachments:",v.map(t=>t.name)),await B({...p,attachments:v}),console.log("âœ… Test email processed successfully"),x({from:"",subject:"",body:""}),F([]),E(!1)}catch(t){console.error("âŒ Failed to send email:",t),alert("Failed to process email. Please check the console for details.")}finally{M(!1)}},O=t=>{t.target.files&&F(Array.from(t.target.files))},T=async t=>{try{await navigator.clipboard.writeText(t),alert("Email address copied!")}catch{try{const m=document.createElement("textarea");m.value=t,m.style.position="fixed",m.style.left="-999999px",m.style.top="-999999px",document.body.appendChild(m),m.focus(),m.select();const I=document.execCommand("copy");document.body.removeChild(m),alert(I?"Email address copied!":"Copy failed. Please manually copy: "+t)}catch{alert("Copy failed. Please manually copy: "+t)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(u,{className:"bg-gradient-to-br from-purple-50 to-violet-50 border-purple-200",children:e.jsx(g,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"size-12 rounded-lg bg-purple-600 flex items-center justify-center flex-shrink-0",children:e.jsx(U,{className:"size-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-gray-900 mb-1",children:"Automatic Invoice Processing via Email"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"This company has a unique email address. Forward invoices here and our AI will automatically:"}),e.jsxs("ul",{className:"text-sm text-gray-600 mb-3 space-y-1 ml-4",children:[e.jsx("li",{children:"â€¢ Extract invoice metadata (vendor, amounts, dates, etc.)"}),e.jsx("li",{children:"â€¢ Store the original PDF/image file"}),e.jsx("li",{children:"â€¢ Add it to the Invoice Extraction workflow"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("code",{className:"px-3 py-2 bg-white border border-purple-300 rounded text-sm text-purple-900 select-all",children:S}),e.jsx(o,{size:"sm",variant:"outline",className:"h-9",onClick:()=>T(S),children:"Copy"}),e.jsxs(ae,{open:L,onOpenChange:E,children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(o,{size:"sm",className:"h-9 gap-2 bg-purple-600 hover:bg-purple-700",children:[e.jsx(K,{className:"size-4"}),"Test Email Parser"]})}),e.jsxs(re,{className:"max-w-2xl",children:[e.jsxs(ie,{children:[e.jsx(le,{children:"Send Test Email with Invoice"}),e.jsx(ce,{children:"Simulate forwarding an email with invoice attachments. The system will automatically: (1) Extract invoice data using AI, (2) Store the file securely, (3) Add it to Invoice Extraction workflow."})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"from",children:"From Email *"}),e.jsx(X,{id:"from",type:"email",placeholder:"sender@example.com",value:p.from,onChange:t=>x({...p,from:t.target.value}),className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"subject",children:"Subject *"}),e.jsx(X,{id:"subject",placeholder:"Invoice from Acme Corp",value:p.subject,onChange:t=>x({...p,subject:t.target.value}),className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"body",children:"Message Body (optional)"}),e.jsx(Re,{id:"body",placeholder:"Please find the attached invoice...",value:p.body,onChange:t=>x({...p,body:t.target.value}),className:"mt-1.5 min-h-24"})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"attachments",children:"Attachments (PDF or Images) *"}),e.jsxs("div",{className:"mt-1.5 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-purple-400 hover:bg-purple-50/50 transition-colors",children:[e.jsx("input",{id:"attachments",type:"file",multiple:!0,accept:".pdf,image/*",onChange:O,className:"hidden"}),e.jsxs("label",{htmlFor:"attachments",className:"cursor-pointer",children:[e.jsx(W,{className:"size-10 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-900 mb-1",children:v.length>0?`${v.length} file(s) selected`:"Click to upload invoice files"}),e.jsx("p",{className:"text-xs text-gray-500",children:"PDF or image files"})]})]}),v.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:v.map((t,w)=>e.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-2",children:[e.jsx(J,{className:"size-3"}),t.name," (",(t.size/1024).toFixed(1)," KB)"]},w))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(o,{variant:"outline",onClick:()=>E(!1),disabled:k,children:"Cancel"}),e.jsx(o,{onClick:R,disabled:k,className:"gap-2 bg-purple-600 hover:bg-purple-700",children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"size-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"size-4"}),"Send & Process"]})})]})]})]})]})]})]})]})})}),e.jsxs(u,{children:[e.jsx(j,{children:e.jsx(y,{children:"Received Emails"})}),e.jsx(g,{children:c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(U,{className:"size-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"No emails received yet"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Forward invoices to ",S," to get started"]})]}):e.jsx("div",{className:"space-y-3",children:c.map(t=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>n(t),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("h4",{className:"text-gray-900",children:t.subject}),e.jsxs(D,{variant:"secondary",className:t.status==="Processed"?"bg-green-100 text-green-700":t.status==="Failed"?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700",children:[t.status==="Processed"&&e.jsx($,{className:"size-3 mr-1"}),t.status==="Received"&&e.jsx(fe,{className:"size-3 mr-1"}),t.status]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["From: ",t.from]})]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(t.receivedAt).toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"size-4"}),t.attachments.length," attachment",t.attachments.length!==1?"s":""]}),t.extractedInvoices>0&&e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx($,{className:"size-4"}),t.extractedInvoices," invoice",t.extractedInvoices!==1?"s":""," extracted"]})]})]},t.id))})})]}),r&&e.jsx(ae,{open:!!r,onOpenChange:()=>n(null),children:e.jsxs(re,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(ie,{children:[e.jsx(le,{children:r.subject}),e.jsxs(ce,{children:["Email received on ",new Date(r.receivedAt).toLocaleString()]})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"text-gray-900",children:"From:"})," ",r.from]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"text-gray-900",children:"Received:"})," ",new Date(r.receivedAt).toLocaleString()]})]}),r.body&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-gray-900 mb-2",children:"Message"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 text-sm text-gray-700 whitespace-pre-wrap",children:r.body})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-gray-900 mb-2",children:["Attachments (",r.attachments.length,")"]}),e.jsx("div",{className:"space-y-2",children:r.attachments.map((t,w)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(J,{className:"size-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-900",children:t.fileName}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(t.fileSize/1024).toFixed(1)," KB"]})]})]}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>window.open(t.fileUrl,"_blank"),children:"View"})]},w))})]}),(r.extractedInvoices>0||r.extractedReceipts>0)&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"size-5 text-green-700 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-green-900 mb-1",children:["Successfully extracted ",r.extractedInvoices||0," invoice",r.extractedInvoices!==1?"s":""," and ",r.extractedReceipts||0," receipt",r.extractedReceipts!==1?"s":""," from this email"]}),e.jsxs("p",{className:"text-sm text-green-700",children:["âœ“ ",r.extractedInvoices>0&&"Invoice metadata extracted with AI",r.extractedInvoices>0&&r.extractedReceipts>0&&" | ",r.extractedReceipts>0&&"Receipt data extracted with AI",e.jsx("br",{}),"âœ“ Original files stored securely",e.jsx("br",{}),"âœ“ Ready for review in ",r.extractedInvoices>0&&"Invoice Extraction",r.extractedInvoices>0&&r.extractedReceipts>0&&" and ",r.extractedReceipts>0&&"Receipt Extraction"," workflow"]})]})]})}),r.extractedInvoices===0&&r.attachments.length>0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(U,{className:"size-5 text-yellow-700 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-yellow-900 mb-1",children:"Files received but no invoices extracted"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"This might happen if attachments are not invoices or are in an unsupported format. Supported formats: PDF, PNG, JPG, JPEG."})]})]})})]})]})})]})}function ds({companyId:c,onNavigate:A,activeTab:b}){const[B,r]=l.useState(b||"overview"),[n,L]=l.useState(null),[E,k]=l.useState([]),[M,p]=l.useState([]),[x,v]=l.useState(null),[F,S]=l.useState([]),[R,O]=l.useState([]),[T,t]=l.useState([]),[w,m]=l.useState(!0),[I,_]=l.useState(null),[de,V]=l.useState(!1),[H,q]=l.useState(!1);l.useEffect(()=>{C()},[c]),l.useEffect(()=>{b&&r(b)},[b]);const C=async()=>{try{m(!0),_(null);const[a,i,s,d,je,ye,ve]=await Promise.all([G.getById(c),Z.getByCompany(c),Se.getByCompany(c),ze.getCompany(c),ee.getByCompany(c),se.getByCompany(c),te.getByCompany(c)]);L(a),k(i),p(s),v(d),S(je),O(ye),t(ve)}catch(a){console.error("Failed to load company data:",a),_(a instanceof Error?a.message:"Failed to load data")}finally{m(!1)}},xe=async a=>{if(confirm(`Are you sure you want to delete "${a.name}"?

This action cannot be undone.`))try{await Z.delete(a.companyId,a.id),h.success("Document deleted successfully"),C()}catch(i){console.error("Failed to delete document:",i),h.error("Failed to delete document")}},me=async a=>{try{const i=await ee.parseEmail(c,a);i.invoices.length>0?h.success(`âœ… Email processed successfully!

${i.invoices.length} invoice${i.invoices.length!==1?"s":""} extracted with metadata.
Files stored securely. View in Workflows â†’ Invoice Extraction.`,{duration:6e3}):h.warning(`Email received but no invoices were extracted.

This might happen if attachments are not in a supported format (PDF, JPG, PNG).`,{duration:5e3}),C()}catch(i){throw console.error("Failed to process email:",i),i}},he=async()=>{if(n)try{await G.update(n.id,{status:"Archived"}),h.success(`${n.name} has been archived`),A("companies")}catch(a){console.error("Failed to archive company:",a),h.error("Failed to archive company")}},pe=async()=>{if(n){q(!0);try{await G.delete(n.id),h.success(`${n.name} has been deleted`),A("companies")}catch(a){console.error("Failed to delete company:",a),h.error("Failed to delete company")}finally{q(!1),V(!1)}}};if(w)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading company..."})]})});if(I||!n)return e.jsxs("div",{className:"p-6 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("p",{className:"text-red-600",children:["Error: ",I||"Company not found"]}),e.jsx(o,{onClick:C,variant:"outline",className:"mt-4",children:"Retry"})]});const ue=[{id:"invoice-extraction",icon:z,title:"Invoice Extraction",description:"Extract and process invoice data",count:`${x?.invoicesExtracted||0} invoices this month`,color:"blue"},{id:"bank-reconciliation",icon:Q,title:"Bank Reconciliation",description:"Match transactions with ledger entries",count:`${x?.bankStatements||0} statements processed`,color:"green"},{id:"ap-reconciliation",icon:be,title:"AP Reconciliation",description:"Reconcile vendor statements",count:"1 reconciliation this month",color:"purple"},{id:"cc-reconciliation",icon:Ge,title:"Credit Card Reconciliation",description:"Review company credit card statements",count:"Upload statements to start",color:"indigo"},{id:"journal-entries",icon:z,title:"Journal Entries",description:"Create journal entries with AI assistance",count:"12 entries generated",color:"orange"},{id:"month-end-close",icon:Y,title:"Month-End Close",description:"Complete month-end procedures",count:x?.monthEndClose||"Not started",color:"red"}],ge=[{step:"Bank reconciliations",status:"completed"},{step:"AP reconciliations",status:"completed"},{step:"Invoice extraction completed",status:"completed"},{step:"Recurring JEs generated",status:"completed"},{step:"Variance analysis",status:"in-progress"},{step:"Final reports exported",status:"pending"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"size-16 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center",children:e.jsx(Je,{className:"size-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl text-gray-900",children:n.name}),e.jsxs("div",{className:"flex gap-3 mt-2 items-center",children:[n.tags?.map((a,i)=>e.jsx(D,{variant:"secondary",className:"text-xs",children:a},i)),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 bg-purple-50 px-3 py-1 rounded-md border border-purple-200",children:[e.jsx(U,{className:"size-4 text-purple-600"}),e.jsx("span",{className:"text-purple-900",children:n.email||`invoices+${c}@novalare.com`})]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",className:"gap-2 h-10",onClick:he,children:[e.jsx(we,{className:"size-4"}),e.jsx("span",{className:"text-sm",children:"Archive"})]}),e.jsxs(o,{variant:"outline",className:"gap-2 h-10",onClick:()=>V(!0),children:[e.jsx(ne,{className:"size-4"}),e.jsx("span",{className:"text-sm",children:"Delete"})]})]})]}),e.jsxs(Ee,{value:B,onValueChange:r,children:[e.jsxs(ke,{children:[e.jsx(N,{value:"overview",children:"Overview"}),e.jsx(N,{value:"emails",children:"Email Inbox"}),e.jsx(N,{value:"documents",children:"Documents"}),e.jsx(N,{value:"workflows",children:"Workflows"}),e.jsx(N,{value:"coa",children:"Chart of Accounts"}),e.jsx(N,{value:"reports",children:"Reports"}),e.jsx(N,{value:"checklist",children:"Close Checklist"})]}),e.jsxs(f,{value:"overview",className:"space-y-6 mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(u,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm text-gray-600",children:"Documents Processed"}),e.jsx(z,{className:"size-4 text-gray-400"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl text-gray-900",children:x?.documentsProcessed||0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This month"})]})]}),e.jsxs(u,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm text-gray-600",children:"Bank Statements"}),e.jsx(Q,{className:"size-4 text-gray-400"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl text-gray-900",children:x?.bankStatements||0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Processed"})]})]}),e.jsxs(u,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm text-gray-600",children:"Invoices Extracted"}),e.jsx(Ce,{className:"size-4 text-gray-400"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl text-gray-900",children:x?.invoicesExtracted||0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This month"})]})]}),e.jsxs(u,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm text-gray-600",children:"Month-End Close"}),e.jsx(Y,{className:"size-4 text-gray-400"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-xl text-gray-900",children:x?.monthEndClose||"Not started"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"March 2024"})]})]})]}),e.jsxs(u,{children:[e.jsx(j,{children:e.jsx(y,{children:"Recent Activity"})}),e.jsx(g,{children:(()=>{const i=[...R.map(s=>({id:`invoice-${s.id}`,type:"invoice",name:s.documentName,vendor:s.vendor,amount:s.gross||"N/A",timestamp:new Date(s.emailReceivedAt||s.createdAt).getTime(),date:new Date(s.emailReceivedAt||s.createdAt),source:s.source})),...T.map(s=>({id:`receipt-${s.id}`,type:"receipt",name:s.fileName,vendor:s.merchant,amount:s.amount!=null&&s.amount!==void 0&&!isNaN(s.amount)?s.amount.toFixed(2):"N/A",timestamp:new Date(s.emailReceivedAt||s.createdAt).getTime(),date:new Date(s.emailReceivedAt||s.createdAt),source:s.source}))].sort((s,d)=>d.timestamp-s.timestamp).slice(0,10);return i.length===0?e.jsx("p",{className:"text-center py-8 text-gray-500",children:"No recent activity"}):e.jsx("div",{className:"space-y-3",children:i.map(s=>e.jsxs("div",{className:"flex items-start gap-4 p-3 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:s.type==="invoice"?"size-10 rounded-lg bg-blue-100 flex items-center justify-center flex-shrink-0":"size-10 rounded-lg bg-green-100 flex items-center justify-center flex-shrink-0",children:s.type==="invoice"?e.jsx(z,{className:"size-5 text-blue-600"}):e.jsx(De,{className:"size-5 text-green-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-900 font-medium truncate",children:s.type==="invoice"?"Invoice received":"Receipt received"}),e.jsx("p",{className:"text-sm text-gray-600 truncate",children:s.vendor})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"text-sm text-gray-900 font-medium",children:s.amount}),e.jsx(D,{variant:"secondary",className:s.source==="email"?"text-[10px] bg-purple-100 text-purple-700 border-purple-200":"text-[10px] bg-gray-100 text-gray-700 border-gray-200",children:s.source==="email"?"via Email":"Uploaded"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.date.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]},s.id))})})()})]})]}),e.jsx(f,{value:"documents",className:"space-y-6 mt-6",children:e.jsxs(u,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{children:"Documents"}),e.jsxs(o,{className:"gap-2 h-10 bg-gray-900 hover:bg-gray-800",children:[e.jsx(W,{className:"size-4"}),e.jsx("span",{className:"text-sm",children:"Upload"})]})]})}),e.jsxs(g,{children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-12 text-center mb-6 hover:border-blue-400 hover:bg-blue-50/50 transition-colors cursor-pointer",children:[e.jsx(W,{className:"size-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-900 mb-1",children:"Drop invoices, statements, receipts here"}),e.jsx("p",{className:"text-xs text-gray-500",children:"or click to browse"})]}),(()=>{const i=[...E.map(s=>({id:s.id,name:s.name,type:s.type,status:s.status,createdAt:s.createdAt,fileUrl:s.fileUrl,source:"upload",originalDoc:s})),...R.map(s=>({id:s.id,name:s.documentName,type:"Invoice",status:s.status,createdAt:s.emailReceivedAt||s.createdAt,fileUrl:s.imageUrl,source:s.source,originalDoc:s})),...T.map(s=>({id:s.id,name:s.fileName,type:"Receipt",status:s.status,createdAt:s.emailReceivedAt||s.createdAt,fileUrl:s.imageUrl,source:s.source,originalDoc:s}))].sort((s,d)=>new Date(d.createdAt).getTime()-new Date(s.createdAt).getTime());return i.length===0?e.jsx("p",{className:"text-center py-8 text-gray-500",children:"No documents uploaded yet"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 text-gray-600 text-sm",children:"File Name"}),e.jsx("th",{className:"text-left py-3 px-4 text-gray-600 text-sm",children:"Type"}),e.jsx("th",{className:"text-left py-3 px-4 text-gray-600 text-sm",children:"Date Uploaded"}),e.jsx("th",{className:"text-left py-3 px-4 text-gray-600 text-sm",children:"Source"}),e.jsx("th",{className:"text-left py-3 px-4 text-gray-600 text-sm",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4 text-gray-600 text-sm",children:"Actions"})]})}),e.jsx("tbody",{children:i.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-4 px-4 text-sm text-gray-900",children:s.name}),e.jsx("td",{className:"py-4 px-4",children:e.jsx(D,{variant:"outline",className:`text-xs ${s.type==="Invoice"?"border-blue-200 text-blue-700 bg-blue-50":s.type==="Receipt"?"border-green-200 text-green-700 bg-green-50":s.type==="Bank Statement"?"border-purple-200 text-purple-700 bg-purple-50":s.type==="Vendor Statement"?"border-orange-200 text-orange-700 bg-orange-50":s.type==="Credit Card Statement"?"border-indigo-200 text-indigo-700 bg-indigo-50":"border-gray-200 text-gray-700 bg-gray-50"}`,children:s.type})}),e.jsx("td",{className:"py-4 px-4 text-sm text-gray-600",children:new Date(s.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"py-4 px-4",children:e.jsx(D,{variant:"secondary",className:s.source==="email"?"text-xs bg-purple-100 text-purple-700 border-purple-200":"text-xs bg-gray-100 text-gray-700 border-gray-200",children:s.source==="email"?"via Email":"Uploaded"})}),e.jsx("td",{className:"py-4 px-4",children:e.jsx(D,{variant:"secondary",className:`text-xs ${s.status==="Processed"||s.status==="Completed"?"bg-green-100 text-green-700":s.status==="Pending"||s.status==="In Progress"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"}`,children:s.status})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex gap-1",children:[s.fileUrl?e.jsxs(e.Fragment,{children:[e.jsxs(o,{variant:"ghost",size:"sm",className:"h-8 text-xs gap-1 text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>window.open(s.fileUrl,"_blank"),children:[e.jsx(Ie,{className:"size-3"}),"View"]}),e.jsxs(o,{variant:"ghost",size:"sm",className:"h-8 text-xs gap-1 text-green-600 hover:text-green-700 hover:bg-green-50",onClick:()=>{const d=document.createElement("a");d.href=s.fileUrl,d.download=s.name,d.click()},children:[e.jsx(Ae,{className:"size-3"}),"Download"]})]}):e.jsx("span",{className:"text-xs text-gray-400",children:"No file"}),e.jsxs(o,{variant:"ghost",size:"sm",className:"h-8 text-xs gap-1 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>{s.type==="Invoice"||s.type==="Receipt"?confirm(`Are you sure you want to delete "${s.name}"?

This action cannot be undone.`)&&(s.type==="Invoice"?se.delete(c,s.id).then(()=>{h.success("Invoice deleted successfully"),C()}).catch(d=>{console.error("Failed to delete invoice:",d),h.error("Failed to delete invoice")}):te.delete(c,s.id).then(()=>{h.success("Receipt deleted successfully"),C()}).catch(d=>{console.error("Failed to delete receipt:",d),h.error("Failed to delete receipt")})):xe(s.originalDoc)},children:[e.jsx(ne,{className:"size-3"}),"Delete"]})]})})]},`${s.type}-${s.id}`))})]})})})()]})]})}),e.jsx(f,{value:"emails",className:"mt-6",children:e.jsx(_e,{emails:F,companyId:c,companyEmail:n?.email,onSendEmail:me})}),e.jsx(f,{value:"workflows",className:"space-y-6 mt-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:ue.map(a=>{const i=a.icon;return e.jsxs(u,{className:"hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>A(a.id,{companyId:c,companyName:n.name}),children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`size-12 rounded-lg bg-${a.color}-100 flex items-center justify-center`,children:e.jsx(i,{className:`size-6 text-${a.color}-600`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(y,{className:"text-lg",children:a.title}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.description})]})]})}),e.jsxs(g,{children:[e.jsx("p",{className:"text-sm text-gray-500",children:a.count}),e.jsx(o,{variant:"outline",className:"w-full mt-4 h-9",children:"Open Workflow"})]})]},a.id)})})}),e.jsx(f,{value:"reports",className:"space-y-6 mt-6",children:e.jsxs(u,{children:[e.jsx(j,{children:e.jsx(y,{children:"Reports"})}),e.jsx(g,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(z,{className:"size-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No reports generated yet"}),e.jsx(o,{variant:"outline",className:"mt-4",children:"Generate Report"})]})})]})}),e.jsx(f,{value:"coa",className:"mt-6",children:e.jsx(Te,{companyId:c,companyName:n.name})}),e.jsx(f,{value:"checklist",className:"space-y-6 mt-6",children:e.jsxs(u,{children:[e.jsx(j,{children:e.jsx(y,{children:"Month-End Close Checklist - March 2024"})}),e.jsx(g,{children:e.jsx("div",{className:"space-y-4",children:ge.map((a,i)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[a.status==="completed"?e.jsx($,{className:"size-6 text-green-600"}):a.status==="in-progress"?e.jsx(oe,{className:"size-6 text-yellow-600 fill-yellow-100"}):e.jsx(oe,{className:"size-6 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:a.step})]}),a.status!=="completed"&&e.jsx(o,{size:"sm",variant:a.status==="in-progress"?"default":"outline",className:"h-8",children:a.status==="in-progress"?"Continue":"Run"})]},i))})})]})})]}),e.jsx(Pe,{open:de,onOpenChange:V,children:e.jsxs(Ue,{children:[e.jsxs($e,{children:[e.jsx(Be,{children:"Are you absolutely sure?"}),e.jsx(Le,{children:"This action cannot be undone. This will permanently delete the company and all related data."})]}),e.jsxs(Me,{children:[e.jsx(Oe,{children:"Cancel"}),e.jsx(Ve,{className:"bg-red-600 hover:bg-red-700",onClick:pe,disabled:H,children:H?"Deleting...":"Delete"})]})]})})]})}export{ds as CompanyWorkspace};
