import{E as at,r as l,t as n,p as w,b as v,j as e,X as rt,F as X,C as P,U as K,a as $,d as L,m as D,h as le,k as de,D as it,T as nt,a5 as ct}from"./index-DrBwAU1T.js";import{C as y,b as z,c as T,d as _,a as j}from"./card-Cmu1fk5m.js";import{B as C}from"./badge-BVkw5bJj.js";import{T as lt,a as dt,b as oe,c as xe}from"./tabs-B1Vb_bsc.js";import{A as B,a as I}from"./alert-C2ImY4gp.js";import{S as $e,a as Le,b as ze,c as Te,d as De}from"./select-BpfYsr0G.js";import{c as ot}from"./api-client-BUzUkZPR.js";import{B as xt}from"./building-Cu8HYSb7.js";import{C as O,g as Re,F as mt}from"./DevPortal--LMNXygJ.js";import{L as E}from"./lock-D9w-vkY7.js";import{E as ht}from"./eye-_8xTnK9v.js";import{T as pt}from"./trash-2-CxXCVqKn.js";import{C as gt}from"./circle-play-HhkG6Ukj.js";import{L as ut}from"./lock-open-D03z0CjY.js";import"./index-BSRUjdZ4.js";function Pt(){const{theme:a}=at(),[M,Pe]=l.useState([]),[x,me]=l.useState(""),[d,he]=l.useState(""),[Ee,pe]=l.useState(!0),[F,q]=l.useState([]),[k,Q]=l.useState([]),[R,W]=l.useState([]),[ge,ue]=l.useState(!1),[Fe,ye]=l.useState(!1),[je,fe]=l.useState(!1),[be,Ne]=l.useState(null),[Z,Ue]=l.useState(!1),[ee,Ae]=l.useState(!1),[S,te]=l.useState([]),[se,_e]=l.useState(null),[ae,Me]=l.useState(!1),[we,ve]=l.useState(!1),[Be,ke]=l.useState(!1),[V,Ce]=l.useState(!1),[Y,J]=l.useState(!1),[o,U]=l.useState(null),[Ie,Oe]=l.useState("cc-statements"),[b,re]=l.useState(!1),[yt,ie]=l.useState(null),G=l.useRef(null),H=l.useRef(null),f=l.useRef(!0),p=t=>t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),Ve=()=>{const t=[],s=new Date;for(let r=0;r<12;r++){const c=new Date(s.getFullYear(),s.getMonth()-r,1),m=c.getFullYear(),h=(c.getMonth()+1).toString().padStart(2,"0"),i=`${m}-${h}`,N=c.toLocaleDateString("en-US",{month:"long",year:"numeric"});t.push({value:i,label:N})}return t};l.useEffect(()=>{f.current=!0,Ye();const t=new Date,s=t.getFullYear(),r=(t.getMonth()+1).toString().padStart(2,"0");return he(`${s}-${r}`),()=>{f.current=!1}},[]),l.useEffect(()=>{x&&d&&(ne(),Se(),Je(),Ge())},[x,d]);const Ye=async()=>{try{pe(!0);const t=await ot.getAll();Pe(t);const s=t.find(r=>r.status==="Active");s&&me(s.id)}catch(t){console.error("Failed to load companies:",t),n.error("Failed to load companies")}finally{pe(!1)}},ne=async()=>{if(!(!x||!d))try{ye(!0);const t=await fetch(`https://${w}.supabase.co/functions/v1/make-server-53c2e113/cc-rec/statements?companyId=${x}&period=${d}`,{headers:{Authorization:`Bearer ${v}`}});if(t.ok){const s=await t.json();console.log("ðŸ“Š CC Data loaded:",{statements:s.statements?.length||0,transactions:s.transactions?.length||0,payments:s.payments?.length||0,sampleStatement:s.statements?.[0],samplePayment:s.payments?.[0]}),f.current&&(q(s.statements||[]),Q(s.transactions||[]),W(s.payments||[]))}else t.status===404&&f.current&&(q([]),Q([]),W([]))}catch{f.current&&(q([]),Q([]),W([]))}finally{f.current&&ye(!1)}},Se=async()=>{if(!(!x||!d))try{ke(!0);const t=await fetch(`https://${w}.supabase.co/functions/v1/make-server-53c2e113/cc-rec/ledger?companyId=${x}&period=${d}`,{headers:{Authorization:`Bearer ${v}`}});if(t.ok){const s=await t.json();console.log("ðŸ“Š Ledger Data loaded:",{entries:s.entries?.length||0,sampleEntry:s.entries?.[0]}),f.current&&te(s.entries||[])}else t.status===404&&f.current&&te([])}catch{f.current&&te([])}finally{f.current&&ke(!1)}},Je=async()=>{if(!(!x||!d))try{const t=await fetch(`https://${w}.supabase.co/functions/v1/make-server-53c2e113/cc-rec/reconciliation?companyId=${x}&period=${d}`,{headers:{Authorization:`Bearer ${v}`}});if(t.ok){const r=(await t.json()).reconciliation;if(r&&r.matched_pairs){console.log("ðŸ“Š Loaded saved reconciliation:",{matchedPairs:r.matched_pairs?.length||0,matchRate:r.summary?.match_rate});const c=r.matched_pairs.map(i=>({transaction:i.cc_transaction,ledgerEntry:i.ledger_entries[0],ledgerEntries:i.ledger_entries,matchType:i.match_type,matchConfidence:i.match_confidence,explanation:i.explanation})),m=r.unmatched_cc.map(i=>i.transaction),h=r.unmatched_ledger.map(i=>i.entry);f.current&&U({matchedPairs:c,unmatchedTransactions:m,unmatchedLedger:h,totalStatementAmount:r.summary.total_cc_amount,totalLedgerAmount:r.summary.total_ledger_amount,matchRate:r.summary.match_rate,summary:r.summary,reconciledAt:r.reconciled_at,locked:r.locked,lockedAt:r.locked_at,unlockedAt:r.unlocked_at})}}else t.status===404&&f.current&&U(null)}catch{console.log("No saved reconciliation found"),f.current&&U(null)}},Ge=async()=>{if(!(!x||!d))try{console.log("ðŸ”’ [CC Rec Review] Loading lock status for:",{selectedCompanyId:x,selectedPeriod:d});const t=await fetch(`https://${w}.supabase.co/functions/v1/make-server-53c2e113/month-close/status?companyId=${x}&period=${d}`,{headers:{Authorization:`Bearer ${v}`}});if(t.ok){const s=await t.json();console.log("ðŸ”’ [CC Rec Review] Lock status loaded:",s),f.current&&(re(s.isLocked||!1),ie(s.lockDetails||null),console.log("ðŸ”’ [CC Rec Review] State updated - isMonthLocked:",s.isLocked))}else console.log("ðŸ”’ [CC Rec Review] Lock status response not OK:",t.status),f.current&&(re(!1),ie(null))}catch(t){console.log("ðŸ”’ [CC Rec Review] Failed to load lock status:",t),f.current&&(re(!1),ie(null))}},He=async t=>{const s=t.target.files;if(!s||s.length===0||!x||!d)return;ue(!0);const r=s.length,c=n.info(`Uploading ${r} ${r===1?"statement":"statements"}...`);try{let m=0,h=0;const i=[];for(let N=0;N<s.length;N++){const g=s[N];n.info(`Processing ${N+1}/${r}: ${g.name}`,{id:c});try{const u=new FormData;u.append("file",g),u.append("companyId",x),u.append("period",d);const ce=await fetch(`https://${w}.supabase.co/functions/v1/make-server-53c2e113/cc-rec/upload-statement`,{method:"POST",headers:{Authorization:`Bearer ${v}`},body:u});if(ce.ok){const A=await ce.json();console.log(`âœ… Upload successful for ${g.name}:`,A),m++,h+=A.transactionCount||0}else{const A=await ce.json().catch(()=>({error:"Unknown error"}));console.error(`âŒ Upload failed for ${g.name}:`,A),i.push(`${g.name}: ${A.details||A.error}`)}}catch(u){console.error(`âŒ Upload error for ${g.name}:`,u),i.push(`${g.name}: ${u instanceof Error?u.message:"Unknown error"}`)}}n.dismiss(c),m===r?n.success(`âœ… Successfully uploaded ${r} ${r===1?"statement":"statements"} with ${h} transactions!`):m>0?(n.warning(`âš ï¸ Uploaded ${m}/${r} statements. ${i.length} failed.`),i.forEach(N=>n.error(N,{duration:5e3}))):(n.error("âŒ All uploads failed"),i.forEach(N=>n.error(N,{duration:5e3}))),await ne()}catch(m){console.error("âŒ Batch upload error:",m),n.error(`Upload failed: ${m instanceof Error?m.message:"Unknown error"}`)}finally{ue(!1),G.current&&(G.current.value="")}},Xe=async t=>{if(!(!x||!d))try{(await fetch(`https://${w}.supabase.co/functions/v1/make-server-53c2e113/cc-rec/statement/${t}?companyId=${x}&period=${d}`,{method:"DELETE",headers:{Authorization:`Bearer ${v}`}})).ok?(n.success("Credit card statement deleted"),await ne()):n.error("Failed to delete credit card statement")}catch(s){console.error("Delete error:",s),n.error("Failed to delete credit card statement")}},Ke=async t=>{if(!t.filePath){n.error("File not found");return}const s=n.loading("Opening statement...",{description:"Preparing your document for viewing"});Ne(t.id);try{const r=await fetch(`https://${w}.supabase.co/functions/v1/make-server-53c2e113/cc-rec/view-statement?filePath=${encodeURIComponent(t.filePath)}`,{headers:{Authorization:`Bearer ${v}`}});if(r.ok){const c=await r.json();window.open(c.signedUrl,"_blank"),n.success("Statement opened!",{id:s,description:"Check your new browser tab"})}else n.error("Failed to load statement",{id:s})}catch(r){console.error("View error:",r),n.error("Failed to load statement",{id:s,description:"Please try again"})}finally{Ne(null)}},qe=async()=>{if(!(!x||!d||k.length===0)){fe(!0);try{const t=await fetch(`https://${w}.supabase.co/functions/v1/make-server-53c2e113/export-cc-statements`,{method:"POST",headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"},body:JSON.stringify({companyId:x,period:d,statements:F,transactions:k})});if(t.ok){const s=await t.blob(),r=window.URL.createObjectURL(s),c=document.createElement("a");c.href=r;const h=`CC_Statements_${M.find(i=>i.id===x)?.name||"Company"}_${d}.xlsx`;c.download=h,document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(r),document.body.removeChild(c),n.success("Credit card statements exported successfully")}else n.error("Failed to export credit card statements")}catch(t){console.error("Export error:",t),n.error("Failed to export credit card statements")}finally{fe(!1)}}},Qe=async()=>{if(k.filter(s=>!s.isPayment).length===0){n.error("Please upload credit card statements with transactions first");return}if(S.length===0){n.error("Please upload credit card ledger entries first");return}Ce(!0);try{const s=await fetch(`https://${w}.supabase.co/functions/v1/make-server-53c2e113/cc-rec/run-reconciliation`,{method:"POST",headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"},body:JSON.stringify({companyId:x,period:d})});if(!s.ok){const i=await s.json();throw new Error(i.error||"Failed to run reconciliation")}const r=await s.json(),c=r.matched_pairs.map(i=>({transaction:i.cc_transaction,ledgerEntry:i.ledger_entries[0],ledgerEntries:i.ledger_entries,matchType:i.match_type,matchConfidence:i.match_confidence,explanation:i.explanation})),m=r.unmatched_cc.map(i=>i.transaction),h=r.unmatched_ledger.map(i=>i.entry);U({matchedPairs:c,unmatchedTransactions:m,unmatchedLedger:h,totalStatementAmount:r.summary.total_cc_amount,totalLedgerAmount:r.summary.total_ledger_amount,matchRate:r.summary.match_rate,summary:r.summary,reconciledAt:r.reconciled_at}),n.success("Credit card reconciliation completed successfully!")}catch(s){const r=s.message||"Failed to run reconciliation";n.error(r),console.error("Reconciliation error:",s)}finally{Ce(!1)}},We=async()=>{if(!o){n.error("No reconciliation to save");return}J(!0);try{const t=await fetch(`https://${w}.supabase.co/functions/v1/make-server-53c2e113/cc-rec/lock-reconciliation`,{method:"POST",headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"},body:JSON.stringify({company_id:x,period:d})});if(!t.ok){const r=await t.json();throw new Error(r.error||"Failed to save reconciliation")}const s=await t.json();U(s.reconciliation),n.success("Reconciliation saved and locked successfully!")}catch(t){const s=t.message||"Failed to save reconciliation";n.error(s),console.error("Lock reconciliation error:",t)}finally{J(!1)}},Ze=async()=>{if(!o){n.error("No reconciliation to unlock");return}J(!0);try{const t=await fetch(`https://${w}.supabase.co/functions/v1/make-server-53c2e113/cc-rec/unlock-reconciliation`,{method:"POST",headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"},body:JSON.stringify({company_id:x,period:d})});if(!t.ok){const r=await t.json();throw new Error(r.error||"Failed to unlock reconciliation")}const s=await t.json();U(s.reconciliation),n.success("Reconciliation unlocked. You can now update it.")}catch(t){const s=t.message||"Failed to unlock reconciliation";n.error(s),console.error("Unlock reconciliation error:",t)}finally{J(!1)}},et=async t=>{const s=t.target.files?.[0];if(!s||!x||!d)return;ve(!0);const r=n.loading("Uploading ledger file...",{description:"Processing your credit card ledger CSV"});try{const c=new FormData;c.append("file",s),c.append("companyId",x),c.append("period",d);const m=await fetch(`https://${w}.supabase.co/functions/v1/make-server-53c2e113/cc-rec/upload-ledger`,{method:"POST",headers:{Authorization:`Bearer ${v}`},body:c});if(m.ok){const h=await m.json();console.log("âœ… Ledger upload successful:",h),n.success("Credit card ledger uploaded successfully",{id:r,description:`${h.entryCount||0} entries processed`}),await Se()}else{const h=await m.json().catch(()=>({error:"Unknown error"}));console.error("âŒ Ledger upload failed:",h),n.error("Failed to upload ledger",{id:r,description:h.details||h.error})}}catch(c){console.error("âŒ Ledger upload error:",c),n.error("Upload failed",{id:r,description:c instanceof Error?c.message:"Unknown error"})}finally{ve(!1),H.current&&(H.current.value="")}},tt=Ve();M.find(t=>t.id===x);const st=k.reduce((t,s)=>{const r=s.cardName||"Unknown Card";return t[r]||(t[r]=[]),t[r].push(s),t},{});return e.jsxs("div",{className:"space-y-10 max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:a==="premium-dark"?"text-4xl tracking-tight text-white":"text-4xl tracking-tight text-gray-900",children:"Credit Card Reconciliation"}),e.jsx("p",{className:a==="premium-dark"?"text-purple-300/40 text-sm mt-2":"text-gray-400 text-sm mt-2",children:"Upload and review company credit card statements"})]})}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsxs($e,{value:x,onValueChange:me,disabled:Ee,children:[e.jsx(Le,{className:a==="premium-dark"?"bg-white/[0.03] border-white/10 text-white hover:bg-white/[0.05] h-11 rounded-xl":"bg-white border-gray-200 text-gray-900 hover:bg-gray-50 h-11 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xt,{className:a==="premium-dark"?"size-4 text-purple-300/40":"size-4 text-gray-400"}),e.jsx(ze,{placeholder:"Select a company"})]})}),e.jsx(Te,{children:M.map(t=>e.jsxs(De,{value:t.id,children:[t.name," (",t.country,")"]},t.id))})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs($e,{value:d,onValueChange:he,children:[e.jsx(Le,{className:a==="premium-dark"?"bg-white/[0.03] border-white/10 text-white hover:bg-white/[0.05] h-11 rounded-xl":"bg-white border-gray-200 text-gray-900 hover:bg-gray-50 h-11 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rt,{className:a==="premium-dark"?"size-4 text-purple-300/40":"size-4 text-gray-400"}),e.jsx(ze,{placeholder:"Select period"})]})}),e.jsx(Te,{children:tt.map(t=>e.jsx(De,{value:t.value,children:t.label},t.value))})]})})]}),x&&d?e.jsxs(lt,{value:Ie,onValueChange:Oe,children:[e.jsxs(dt,{className:a==="premium-dark"?"grid w-full grid-cols-3 h-auto p-1 bg-white/[0.03] border border-white/5":"grid w-full grid-cols-3 h-auto p-1",children:[e.jsxs(oe,{value:"cc-statements",className:"gap-2 py-3",children:[e.jsx(X,{className:"size-4"}),"Credit Card Statements",(k.length>0||R.length>0)&&e.jsx(P,{className:"size-4 ml-1"})]}),e.jsxs(oe,{value:"cc-ledger",className:"gap-2 py-3",children:[e.jsx(O,{className:"size-4"}),"Credit Card Ledger"]}),e.jsxs(oe,{value:"reconciliation",className:"gap-2 py-3",children:[e.jsx(P,{className:"size-4"}),"Reconciliation"]})]}),e.jsxs(xe,{value:"cc-statements",className:"space-y-6",children:[b&&e.jsxs(B,{className:"bg-gray-900 border-gray-800",children:[e.jsx(E,{className:"size-4 text-white"}),e.jsxs(I,{className:"text-white",children:[e.jsx("strong",{children:"Period is locked."})," This period has been closed and locked. You cannot upload or modify credit card statements while the period is locked."]})]}),!b&&o?.locked&&e.jsxs(B,{className:"bg-amber-50 border-amber-200",children:[e.jsx(E,{className:"size-4 text-amber-600"}),e.jsxs(I,{className:"text-amber-900",children:[e.jsx("strong",{children:"Uploads are locked."})," This company's reconciliation for ",d,' is locked. To upload more credit card statements, click "Update Reconciliation" in the Reconciliation tab to unlock it.']})]}),e.jsxs(y,{className:a==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(T,{className:a==="premium-dark"?"flex items-center gap-2 text-white":"flex items-center gap-2",children:[e.jsx(K,{className:a==="premium-dark"?"size-5 text-purple-300/60":"size-5 text-purple-600"}),"Upload Credit Card Statements"]}),e.jsx(_,{className:a==="premium-dark"?"mt-1 text-gray-400":"mt-1",children:"Upload credit card statements (PDF, Excel, or CSV). AI will automatically extract all transactions."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{onClick:()=>G.current?.click(),disabled:ge||b||o?.locked,className:a==="premium-dark"?"bg-white text-black hover:bg-white/90 rounded-xl":"bg-black text-white hover:bg-black/90 rounded-xl",children:ge?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"size-4 mr-2 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"size-4 mr-2"}),"Upload Statement"]})}),e.jsx("input",{ref:G,type:"file",onChange:He,accept:".pdf,.csv,.xlsx,.xls",multiple:!0,className:"hidden"})]})]})}),e.jsx(j,{children:Fe?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{className:"size-8 animate-spin text-purple-600"})}):F.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(X,{className:"size-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{children:"No credit card statements uploaded yet."}),e.jsx("p",{className:"text-sm mt-1",children:"Upload your first statement to get started."})]}):e.jsx("div",{className:"space-y-4",children:F.map(t=>e.jsxs(D.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"border border-gray-200 rounded-xl overflow-hidden hover:border-purple-300 hover:shadow-md transition-all",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"size-12 rounded-lg bg-purple-100 flex items-center justify-center shadow-sm",children:e.jsx(O,{className:"size-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg text-gray-900",children:t.cardName||"Unknown Card"}),t.cardLast4&&e.jsxs(C,{variant:"secondary",className:"text-xs",children:["â€¢â€¢",t.cardLast4]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"size-3"}),t.fileName]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[t.transactionCount," transactions"]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:new Date(t.uploadedAt).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx($,{variant:"ghost",size:"sm",className:"gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50 hover:shadow-sm transition-all",onClick:()=>Ke(t),disabled:be===t.id,children:be===t.id?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"size-4 animate-spin"}),"Opening..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ht,{className:"size-4"}),"View"]})})}),e.jsx(D.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs($,{variant:"ghost",size:"sm",className:"gap-2 text-red-600 hover:text-red-700 hover:bg-red-50 hover:shadow-sm transition-all",onClick:()=>Xe(t.id),children:[e.jsx(pt,{className:"size-4"}),"Delete"]})})]})]})}),e.jsx("div",{className:"bg-white px-6 py-5",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6",children:[t.statementBalance!==null&&t.statementBalance!==void 0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Statement Balance"}),e.jsxs("p",{className:"text-lg text-gray-900",children:["$",p(t.statementBalance)]})]}),t.paymentDueDate&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Payment Due"}),e.jsx("p",{className:"text-lg text-gray-900",children:new Date(t.paymentDueDate).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),t.paymentMinimum!==null&&t.paymentMinimum!==void 0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Minimum Payment"}),e.jsxs("p",{className:"text-lg text-gray-900",children:["$",p(t.paymentMinimum)]})]}),t.previousBalance!==null&&t.previousBalance!==void 0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Previous Balance"}),e.jsxs("p",{className:"text-lg text-gray-900",children:["$",p(t.previousBalance)]})]}),t.newCharges!==null&&t.newCharges!==void 0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"New Charges"}),e.jsxs("p",{className:"text-lg text-gray-900",children:["$",p(t.newCharges)]})]})]})})]},t.id))})})]}),R.length>0&&e.jsxs(y,{className:a==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:[e.jsx(z,{className:a==="premium-dark"?"cursor-pointer hover:bg-white/[0.05] transition-colors":"cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>Ue(!Z),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(T,{className:a==="premium-dark"?"flex items-center gap-2 text-white":"flex items-center gap-2",children:[e.jsx(O,{className:a==="premium-dark"?"size-5 text-purple-300/60":"size-5 text-gray-600"}),"Payment Transactions",e.jsx(C,{variant:"secondary",className:"ml-2",children:R.length})]}),e.jsx(_,{className:a==="premium-dark"?"text-gray-400":"",children:"Track credit card payments to verify that cards were paid correctly each month."})]}),e.jsx(D.div,{animate:{rotate:Z?180:0},transition:{duration:.2},children:e.jsx(Re,{className:"size-5 text-gray-500"})})]})}),e.jsx(le,{children:Z&&e.jsx(D.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},style:{overflow:"hidden"},children:e.jsx(j,{children:e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-gray-700",children:"Card"}),e.jsx("th",{className:"px-4 py-3 text-left text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-right text-gray-700",children:"Payment Amount"}),e.jsx("th",{className:"px-4 py-3 text-center text-gray-700",children:"Status"})]})}),e.jsx("tbody",{children:R.map((t,s)=>e.jsxs("tr",{className:s%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:new Date(t.date).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-900",children:t.cardName||"Unknown"}),t.cardLast4&&e.jsxs("p",{className:"text-xs text-gray-500",children:["â€¢â€¢",t.cardLast4]})]})}),e.jsx("td",{className:a==="premium-dark"?"px-4 py-3 text-white":"px-4 py-3 text-gray-900",children:t.description}),e.jsxs("td",{className:a==="premium-dark"?"px-4 py-3 text-right text-white":"px-4 py-3 text-right text-gray-900",children:["$",p(Math.abs(t.amount))]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx(C,{variant:"outline",className:"text-xs bg-yellow-50 text-yellow-700 border-yellow-300",children:"Pending Match"})})]},t.id))}),e.jsx("tfoot",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:a==="premium-dark"?"px-4 py-3 text-right text-gray-300":"px-4 py-3 text-right text-gray-700",children:"Total Payments:"}),e.jsxs("td",{className:a==="premium-dark"?"px-4 py-3 text-right text-white":"px-4 py-3 text-right text-gray-900",children:["$",p(R.reduce((t,s)=>t+Math.abs(s.amount),0))]}),e.jsx("td",{})]})})]})})})})})]}),R.length>0&&e.jsxs(y,{className:a==="premium-dark"?"border-2 border-white/10 bg-white/[0.03] rounded-2xl":"border-2 border-purple-200 bg-gradient-to-br from-purple-50 to-blue-50 rounded-2xl",children:[e.jsx(z,{className:a==="premium-dark"?"cursor-pointer hover:bg-white/[0.05] transition-colors":"cursor-pointer hover:bg-purple-100/50 transition-colors",onClick:()=>Ae(!ee),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(T,{className:a==="premium-dark"?"flex items-center gap-2 text-lg text-white":"flex items-center gap-2 text-lg",children:[e.jsx(P,{className:a==="premium-dark"?"size-5 text-purple-300/60":"size-5 text-purple-600"}),"Settlement Check - Liability Clearance"]}),e.jsx(_,{className:a==="premium-dark"?"text-gray-400":"",children:"Verify that credit card liability reconciles correctly after payments"})]}),e.jsx(D.div,{animate:{rotate:ee?180:0},transition:{duration:.2},children:e.jsx(Re,{className:"size-5 text-purple-600"})})]})}),e.jsx(le,{children:ee&&e.jsx(D.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},style:{overflow:"hidden"},children:e.jsx(j,{children:(()=>{const t=F.reduce((g,u)=>g+(u.previousBalance||0),0),s=F.reduce((g,u)=>g+(u.newCharges||0),0),r=R.reduce((g,u)=>g+Math.abs(u.amount),0),c=k.filter(g=>g.amount<0).reduce((g,u)=>g+Math.abs(u.amount),0),m=t+s-r-c,h=F.reduce((g,u)=>g+(u.statementBalance||0),0),i=Math.abs(m-h)<.01,N=h-m;return e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-200",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Opening Credit Card Balance"}),e.jsxs("span",{className:"text-gray-900",children:["$",p(t)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"+ New Charges"}),e.jsxs("span",{className:"text-gray-900",children:["$",p(s)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:a==="premium-dark"?"text-sm text-gray-400":"text-sm text-gray-600",children:"- Payments Made"}),e.jsxs("span",{className:a==="premium-dark"?"text-white":"text-gray-900",children:["($$",p(r),")"]})]}),e.jsxs("div",{className:a==="premium-dark"?"flex justify-between items-center pb-3 border-b border-white/10":"flex justify-between items-center pb-3 border-b border-gray-200",children:[e.jsx("span",{className:a==="premium-dark"?"text-sm text-gray-400":"text-sm text-gray-600",children:"- Refunds & Credits"}),e.jsxs("span",{className:a==="premium-dark"?"text-white":"text-gray-900",children:["($$",p(c),")"]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2",children:[e.jsx("span",{className:"text-gray-900",children:"Expected Ending Balance"}),e.jsxs("span",{className:"text-lg text-gray-900",children:["$",p(m)]})]}),e.jsxs("div",{className:"flex justify-between items-center pb-3 border-b-2 border-gray-300",children:[e.jsx("span",{className:"text-gray-900",children:"Ledger Ending Balance"}),e.jsxs("span",{className:"text-lg text-gray-900",children:["$",p(h)]})]}),e.jsxs("div",{className:`flex justify-between items-center pt-3 ${i?"bg-green-50":"bg-red-50"} -mx-6 -mb-6 px-6 py-4 rounded-b-lg`,children:[e.jsx("div",{className:"flex items-center gap-2",children:i?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:a==="premium-dark"?"size-5 text-white":"size-5 text-gray-900"}),e.jsx("span",{className:a==="premium-dark"?"text-white":"text-gray-900",children:"Credit Card Liability Reconciles Correctly"})]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"size-5 text-red-600"}),e.jsx("span",{className:"text-red-900",children:"Credit Card Liability Does Not Reconcile - Review Required"})]})}),!i&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-red-600",children:"Difference"}),e.jsxs("div",{className:"text-red-900",children:["$",p(Math.abs(N))]})]})]})]})})})})()})})})]}),k.length>0&&e.jsxs(y,{children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"size-5 text-purple-600"}),"Expenses & Transactions"]}),e.jsx(_,{className:"mt-1",children:"Review all expense transactions extracted from credit card statements (excluding payments)."})]}),e.jsx($,{onClick:qe,disabled:je,variant:"outline",size:"sm",children:je?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"size-4 mr-2 animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(it,{className:"size-4 mr-2"}),"Export to Excel"]})})]})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm text-gray-700 mb-3",children:["Expense Transactions (",k.length,")"]}),Object.entries(st).map(([t,s])=>e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(O,{className:"size-4 text-purple-600"}),e.jsx("h5",{className:"text-gray-900",children:t}),e.jsxs(C,{variant:"secondary",children:[s.length," transactions"]})]}),e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-gray-700",children:"Merchant"}),e.jsx("th",{className:"px-4 py-3 text-left text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-right text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:s.map((r,c)=>e.jsxs("tr",{className:c%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:new Date(r.date).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:r.description}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:r.merchant||"-"}),e.jsx("td",{className:"px-4 py-3",children:r.category&&e.jsx(C,{variant:"outline",className:"text-xs",children:r.category})}),e.jsxs("td",{className:a==="premium-dark"?"px-4 py-3 text-right text-white":"px-4 py-3 text-right text-gray-900",children:["$",p(Math.abs(r.amount))]})]},r.id))}),e.jsx("tfoot",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"px-4 py-3 text-right text-gray-700",children:"Total:"}),e.jsxs("td",{className:"px-4 py-3 text-right text-gray-900",children:["$",p(s.reduce((r,c)=>r+Math.abs(c.amount),0))]})]})})]})})]},t))]})})})]})]}),e.jsxs(xe,{value:"cc-ledger",className:"space-y-6",children:[b&&e.jsxs(B,{className:"bg-gray-900 border-gray-800",children:[e.jsx(E,{className:"size-4 text-white"}),e.jsxs(I,{className:"text-white",children:[e.jsx("strong",{children:"Period is locked."})," This period has been closed and locked. You cannot upload or modify the credit card ledger while the period is locked."]})]}),!b&&o?.locked&&e.jsxs(B,{className:"bg-amber-50 border-amber-200",children:[e.jsx(E,{className:"size-4 text-amber-600"}),e.jsxs(I,{className:"text-amber-900",children:[e.jsx("strong",{children:"Uploads are locked."})," This company's reconciliation for ",d,' is locked. To upload or modify the credit card ledger, click "Update Reconciliation" in the Reconciliation tab to unlock it.']})]}),e.jsxs(y,{className:a==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(T,{className:a==="premium-dark"?"flex items-center gap-2 text-white":"flex items-center gap-2",children:[e.jsx(K,{className:a==="premium-dark"?"size-5 text-purple-300/60":"size-5 text-teal-600"}),"Upload Credit Card Ledger"]}),e.jsx(_,{className:a==="premium-dark"?"mt-1 text-gray-400":"mt-1",children:"Upload your credit card ledger from QuickBooks, Xero, or DATEV (CSV format). This contains the accounting entries for your credit card account."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{onClick:()=>H.current?.click(),disabled:we||b||o?.locked,className:a==="premium-dark"?"bg-white text-black hover:bg-white/90 rounded-xl":"bg-black text-white hover:bg-black/90 rounded-xl",children:we?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"size-4 mr-2 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"size-4 mr-2"}),"Upload Ledger CSV"]})}),e.jsx("input",{ref:H,type:"file",onChange:et,accept:".csv",className:"hidden"})]})]})}),e.jsx(j,{children:Be?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{className:"size-8 animate-spin text-teal-600"})}):S.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(mt,{className:"size-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{children:"No credit card ledger uploaded yet."}),e.jsx("p",{className:"text-sm mt-1",children:"Upload a CSV file from your accounting system to get started."}),e.jsxs("div",{className:"mt-6 text-left max-w-md mx-auto bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-900 mb-2",children:"Expected CSV format:"}),e.jsx("div",{className:"bg-white rounded px-3 py-2 text-xs",children:e.jsxs("code",{className:"text-gray-700",children:["Date, Description, Debit, Credit, Balance, Reference",e.jsx("br",{}),"2025-10-01, Opening Balance, 0.00, 0.00, 150.00, -",e.jsx("br",{}),"2025-10-05, Amazon Purchase, 45.23, 0.00, 195.23, INV-001",e.jsx("br",{}),"2025-10-15, Payment, 0.00, 150.00, 45.23, PMT-001"]})})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-sm text-gray-700",children:["Ledger Entries (",S.length,")"]}),e.jsxs(C,{variant:"outline",className:"text-xs bg-teal-50 text-teal-700 border-teal-300",children:["Last upload: ",new Date().toLocaleDateString()]})]}),e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-gray-700",children:"Posting Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-gray-700",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-gray-700",children:"Memo"}),e.jsx("th",{className:"px-4 py-3 text-right text-gray-700",children:"Debit"}),e.jsx("th",{className:"px-4 py-3 text-right text-gray-700",children:"Credit"}),e.jsx("th",{className:"px-4 py-3 text-left text-gray-700",children:"GL Account"}),e.jsx("th",{className:"px-4 py-3 text-left text-gray-700",children:"Reference"})]})}),e.jsx("tbody",{children:S.map((t,s)=>e.jsxs("tr",{className:s%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:new Date(t.date).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:t.vendor}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:t.memo||"-"}),e.jsxs("td",{className:a==="premium-dark"?`px-4 py-3 text-right ${t.debit>0?"text-white":"text-gray-500"}`:`px-4 py-3 text-right ${t.debit>0?"text-gray-900":"text-gray-400"}`,children:["$",p(t.debit)]}),e.jsxs("td",{className:a==="premium-dark"?`px-4 py-3 text-right ${t.credit>0?"text-white":"text-gray-500"}`:`px-4 py-3 text-right ${t.credit>0?"text-gray-900":"text-gray-400"}`,children:["$",p(t.credit)]}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:t.glAccount||"-"}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:t.reference||"-"})]},t.id))}),e.jsx("tfoot",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"px-4 py-3 text-right text-gray-700",children:"Totals:"}),e.jsxs("td",{className:a==="premium-dark"?"px-4 py-3 text-right text-white":"px-4 py-3 text-right text-gray-900",children:["$",p(S.reduce((t,s)=>t+s.debit,0))]}),e.jsxs("td",{className:a==="premium-dark"?"px-4 py-3 text-right text-white":"px-4 py-3 text-right text-gray-900",children:["$",p(S.reduce((t,s)=>t+s.credit,0))]}),e.jsx("td",{colSpan:2})]})})]})})]})})]})]}),e.jsxs(xe,{value:"reconciliation",className:"space-y-6",children:[b&&e.jsxs(B,{className:"bg-gray-900 border-gray-800",children:[e.jsx(E,{className:"size-4 text-white"}),e.jsxs(I,{className:"text-white",children:[e.jsx("strong",{children:"Period is locked."})," This period has been closed and locked. You cannot run or update the reconciliation while the period is locked."]})]}),e.jsxs(y,{className:a==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:[e.jsxs(z,{children:[e.jsx(T,{className:a==="premium-dark"?"text-white":"",children:"Run Reconciliation"}),e.jsx(_,{className:a==="premium-dark"?"text-gray-400":"",children:"Match credit card statement transactions with ledger entries"})]}),e.jsxs(j,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:a==="premium-dark"?"p-5 bg-white/[0.02] border border-white/5 rounded-2xl":"p-5 bg-gray-50/50 border border-gray-100 rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:a==="premium-dark"?"text-sm text-purple-300/40":"text-sm text-gray-400",children:"Statement Transactions"}),k.filter(t=>!t.isPayment).length>0&&e.jsx(P,{className:a==="premium-dark"?"size-4 text-white":"size-4 text-gray-600"})]}),e.jsx("p",{className:a==="premium-dark"?"text-3xl text-white tracking-tight":"text-3xl text-gray-900 tracking-tight",children:k.filter(t=>!t.isPayment).length}),e.jsx("p",{className:a==="premium-dark"?"text-xs text-purple-300/30 mt-1":"text-xs text-gray-400 mt-1",children:"expense transactions"})]}),e.jsxs("div",{className:a==="premium-dark"?"p-5 bg-white/[0.02] border border-white/5 rounded-2xl":"p-5 bg-gray-50/50 border border-gray-100 rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:a==="premium-dark"?"text-sm text-purple-300/40":"text-sm text-gray-400",children:"Ledger Entries"}),S.length>0&&e.jsx(P,{className:a==="premium-dark"?"size-4 text-white":"size-4 text-gray-600"})]}),e.jsx("p",{className:a==="premium-dark"?"text-3xl text-white tracking-tight":"text-3xl text-gray-900 tracking-tight",children:S.length}),e.jsx("p",{className:a==="premium-dark"?"text-xs text-purple-300/30 mt-1":"text-xs text-gray-400 mt-1",children:"ledger entries"})]})]}),e.jsx($,{onClick:Qe,disabled:V||k.filter(t=>!t.isPayment).length===0||S.length===0||b||o?.locked,className:a==="premium-dark"?"w-full gap-2 h-12 bg-white text-black hover:bg-white/90 rounded-full":"w-full gap-2 h-12 bg-black text-white hover:bg-gray-900 rounded-full",size:"lg",children:V?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"size-5 animate-spin"}),"Running Reconciliation..."]}):e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"size-5"}),o?.locked?"Reconciliation Locked":b?"Period Locked":"Run Reconciliation"]})})]})]}),V&&e.jsx(y,{children:e.jsx(j,{className:"py-12",children:e.jsx(ProcessingStages,{type:"cc-rec"})})}),o&&!V&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(y,{className:a==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:e.jsx(j,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:a==="premium-dark"?"text-sm text-purple-300/40":"text-sm text-gray-400",children:"Matched"}),e.jsx("p",{className:a==="premium-dark"?"text-3xl text-white mt-1 tracking-tight":"text-3xl text-gray-900 mt-1 tracking-tight",children:o.matchedPairs?.length??0})]}),e.jsx("div",{className:a==="premium-dark"?"h-12 w-12 rounded-full bg-violet-500/10 flex items-center justify-center":"h-12 w-12 rounded-full bg-violet-50 flex items-center justify-center",children:e.jsx(P,{className:"size-6 text-violet-600"})})]})})}),e.jsx(y,{className:a==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:e.jsx(j,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:a==="premium-dark"?"text-sm text-purple-300/40":"text-sm text-gray-400",children:"Unmatched CC"}),e.jsx("p",{className:a==="premium-dark"?"text-3xl text-white mt-1 tracking-tight":"text-3xl text-gray-900 mt-1 tracking-tight",children:o.unmatchedTransactions?.length??0})]}),e.jsx("div",{className:a==="premium-dark"?"h-12 w-12 rounded-full bg-white/5 flex items-center justify-center":"h-12 w-12 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(de,{className:a==="premium-dark"?"size-6 text-white/30":"size-6 text-gray-500"})})]})})}),e.jsx(y,{className:a==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:e.jsx(j,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:a==="premium-dark"?"text-sm text-purple-300/40":"text-sm text-gray-400",children:"Unmatched Ledger"}),e.jsx("p",{className:a==="premium-dark"?"text-3xl text-white mt-1 tracking-tight":"text-3xl text-gray-900 mt-1 tracking-tight",children:o.unmatchedLedger?.length??0})]}),e.jsx("div",{className:a==="premium-dark"?"h-12 w-12 rounded-full bg-white/5 flex items-center justify-center":"h-12 w-12 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(de,{className:a==="premium-dark"?"size-6 text-white/30":"size-6 text-gray-500"})})]})})}),e.jsx(y,{className:a==="premium-dark"?"bg-white/[0.03] border-white/5 rounded-2xl":"bg-white border-gray-100 rounded-2xl",children:e.jsx(j,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:a==="premium-dark"?"text-sm text-purple-300/40":"text-sm text-gray-400",children:"Match Rate"}),e.jsxs("p",{className:"text-3xl text-violet-500 mt-1 tracking-tight",children:[o.matchRate?.toFixed(1)??0,"%"]})]}),e.jsx("div",{className:a==="premium-dark"?"h-12 w-12 rounded-full bg-violet-500/10 flex items-center justify-center":"h-12 w-12 rounded-full bg-violet-50 flex items-center justify-center",children:e.jsx(nt,{className:"size-6 text-violet-500"})})]})})})]}),!b&&o.locked?e.jsx(y,{className:a==="premium-dark"?"bg-green-500/10 border-green-500/30 rounded-2xl":"bg-green-50 border-green-200 rounded-2xl",children:e.jsx(j,{className:"pt-6 pb-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:a==="premium-dark"?"h-12 w-12 rounded-xl bg-green-500/20 border border-green-500/30 flex items-center justify-center flex-shrink-0":"h-12 w-12 rounded-xl bg-green-100 flex items-center justify-center flex-shrink-0",children:e.jsx(E,{className:a==="premium-dark"?"size-5 text-green-400":"size-5 text-green-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:a==="premium-dark"?"text-green-400":"text-green-900",children:"Reconciliation Locked"}),e.jsxs("p",{className:a==="premium-dark"?"text-sm text-green-400/70 mt-1":"text-sm text-green-700 mt-1",children:["This reconciliation has been saved and locked for ",M.find(t=>t.id===x)?.name," - ",d,".",o.lockedAt&&e.jsxs("span",{className:"block mt-1",children:["Locked on: ",new Date(o.lockedAt).toLocaleString()]})]})]})]}),e.jsx($,{onClick:Ze,disabled:Y||b,variant:"outline",className:a==="premium-dark"?"gap-2 bg-green-500/10 border-green-500/30 text-green-400 hover:bg-green-500/20 rounded-full flex-shrink-0":"gap-2 border-green-300 hover:bg-green-100 rounded-full flex-shrink-0",children:Y?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"size-4 animate-spin"}),"Unlocking..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ut,{className:"size-4"}),"Update Reconciliation"]})})]})})}):e.jsx(y,{className:a==="premium-dark"?"bg-white/[0.03] border-white/10 rounded-2xl":"bg-gray-50 border-gray-200 rounded-2xl",children:e.jsx(j,{className:"pt-6 pb-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:a==="premium-dark"?"h-12 w-12 rounded-xl bg-white/5 flex items-center justify-center flex-shrink-0":"h-12 w-12 rounded-xl bg-white flex items-center justify-center flex-shrink-0",children:e.jsx(ct,{className:a==="premium-dark"?"size-5 text-white/60":"size-5 text-gray-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:a==="premium-dark"?"text-white":"text-gray-900",children:"Please Review Before Saving"}),e.jsxs("p",{className:a==="premium-dark"?"text-sm text-gray-400 mt-1":"text-sm text-gray-500 mt-1",children:["Carefully review the reconciliation results above to ensure accuracy. Once locked, this reconciliation will be saved for ",M.find(t=>t.id===x)?.name," - ",d,"."]})]})]}),e.jsx($,{onClick:We,disabled:Y||b,variant:"outline",className:a==="premium-dark"?"gap-2 bg-white text-black hover:bg-white/90 rounded-full flex-shrink-0 border-0":"gap-2 bg-black text-white hover:bg-gray-900 rounded-full flex-shrink-0 border-0",children:Y?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"size-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"size-4"}),"Save & Lock"]})})]})})}),(o.matchedPairs?.length??0)>0&&e.jsxs(y,{children:[e.jsx(z,{className:"border-b bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(T,{className:"text-base",children:"Matched Transactions"}),e.jsx(C,{variant:"secondary",className:"bg-green-50 text-green-700 border-green-200",children:o.matchedPairs?.length??0})]})}),e.jsxs(j,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Description"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Amount"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Card"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Type"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Confidence"}),e.jsx("th",{className:"text-center py-3 px-6 text-xs text-gray-500 font-medium"})]})}),e.jsx("tbody",{children:(ae?o.matchedPairs??[]:o.matchedPairs?.slice(0,10)??[]).map((t,s)=>e.jsxs(l.Fragment,{children:[e.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>_e(se===s?null:s),children:[e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:t.transaction.date}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-900",children:t.transaction.description}),e.jsxs("td",{className:"py-4 px-6 text-sm text-gray-900 font-medium",children:["$",Math.abs(t.transaction.amount).toFixed(2)]}),e.jsxs("td",{className:"py-4 px-6 text-sm text-gray-600",children:[t.transaction.cardName,t.transaction.cardLast4&&` â€¢â€¢${t.transaction.cardLast4}`]}),e.jsx("td",{className:"py-4 px-6",children:e.jsx(C,{variant:"outline",className:t.matchType==="exact"?"bg-violet-50 text-violet-700 border-violet-200":t.matchType==="one_to_many"?"bg-green-50 text-green-700 border-green-200":t.matchType==="many_to_one"?"bg-orange-50 text-orange-700 border-orange-200":t.matchType==="fx"?"bg-blue-50 text-blue-700 border-blue-200":"bg-gray-50 text-gray-600 border-gray-200",children:t.matchType==="exact"?"exact":t.matchType==="one_to_many"?"1:Many":t.matchType==="many_to_one"?"Many:1":t.matchType==="fx"?"FX":t.matchType})}),e.jsxs("td",{className:"py-4 px-6 text-sm text-gray-600",children:[t.matchConfidence.toFixed(0),"%"]}),e.jsx("td",{className:"py-4 px-6 text-center",children:e.jsx("span",{className:"text-gray-400 text-xs",children:se===s?"â–²":"â–¼"})})]}),e.jsx(le,{children:se===s&&e.jsx(D.tr,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsx("td",{colSpan:7,className:"bg-gray-50 px-6 py-4 border-b",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium mb-2",children:"Matched Ledger Entry:"}),e.jsx("div",{className:"bg-white border border-gray-200 rounded px-3 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-gray-900",children:t.ledgerEntry.vendor}),t.ledgerEntry.memo&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t.ledgerEntry.memo}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t.ledgerEntry.date,t.ledgerEntry.glAccount&&` â€¢ GL Account: ${t.ledgerEntry.glAccount}`]})]}),e.jsxs("p",{className:"text-gray-900 font-medium ml-4",children:["$",t.ledgerEntry.debit.toFixed(2)]})]})})]})})})})]},s))})]})}),(o.matchedPairs?.length??0)>10&&e.jsx("div",{className:"border-t bg-gray-50 py-3 text-center",children:e.jsx($,{variant:"ghost",size:"sm",onClick:()=>Me(!ae),className:"text-green-600 hover:text-green-700 hover:bg-green-50",children:ae?"Show Less":`Show ${(o.matchedPairs?.length??0)-10} More Transaction${(o.matchedPairs?.length??0)-10!==1?"s":""}`})})]})]}),(o.unmatchedTransactions?.length??0)>0&&e.jsxs(y,{children:[e.jsx(z,{className:"border-b bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(T,{className:"text-base",children:"Unmatched Statement Transactions"}),e.jsx(C,{variant:"secondary",className:"bg-amber-50 text-amber-700 border-amber-200",children:o.unmatchedTransactions?.length??0})]})}),e.jsx(j,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Description"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Amount"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Card"})]})}),e.jsx("tbody",{children:(o.unmatchedTransactions??[]).map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:t.date}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-900",children:t.description}),e.jsxs("td",{className:"py-4 px-6 text-sm text-gray-900 font-medium",children:["$",Math.abs(t.amount).toFixed(2)]}),e.jsxs("td",{className:"py-4 px-6 text-sm text-gray-600",children:[t.cardName,t.cardLast4&&` â€¢â€¢${t.cardLast4}`]})]},t.id))})]})})})]}),(o.unmatchedLedger?.length??0)>0&&e.jsxs(y,{children:[e.jsx(z,{className:"border-b bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(T,{className:"text-base",children:"Unmatched Ledger Entries"}),e.jsx(C,{variant:"secondary",className:"bg-red-50 text-red-700 border-red-200",children:o.unmatchedLedger?.length??0})]})}),e.jsx(j,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Vendor"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Memo"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"Amount"}),e.jsx("th",{className:"text-left py-3 px-6 text-xs text-gray-500 font-medium",children:"GL Account"})]})}),e.jsx("tbody",{children:(o.unmatchedLedger??[]).map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:t.date}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-900",children:t.vendor}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:t.memo||"-"}),e.jsxs("td",{className:"py-4 px-6 text-sm text-gray-900 font-medium",children:["$",t.debit.toFixed(2)]}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:t.glAccount||"-"})]},t.id))})]})})})]})]})]})]}):e.jsx(y,{children:e.jsx(j,{className:"py-12",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(O,{className:"size-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{children:"Select a company and period to begin"})]})})})]})}export{Pt as CreditCardReconciliation};
